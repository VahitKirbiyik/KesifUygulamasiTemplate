using Microsoft.Maui.Controls;\n\nnamespace KesifUygulamasiTemplate.Behaviors\n{\n    public class RotationBehavior : Behavior<VisualElement>\n    {\n        public static readonly BindableProperty IsRotatingProperty =\n            BindableProperty.Create(nameof(IsRotating), typeof(bool), typeof(RotationBehavior), false,\n                propertyChanged: OnIsRotatingChanged);\n\n        public static readonly BindableProperty DurationProperty =\n            BindableProperty.Create(nameof(Duration), typeof(uint), typeof(RotationBehavior), (uint)1000);\n\n        public bool IsRotating\n        {\n            get => (bool)GetValue(IsRotatingProperty);\n            set => SetValue(IsRotatingProperty, value);\n        }\n\n        public uint Duration\n        {\n            get => (uint)GetValue(DurationProperty);\n            set => SetValue(DurationProperty, value);\n        }\n\n        private VisualElement? _associatedObject;\n\n        protected override void OnAttachedTo(VisualElement bindable)\n        {\n            base.OnAttachedTo(bindable);\n            _associatedObject = bindable;\n\n            if (IsRotating)\n            {\n                StartRotationAnimation();\n            }\n        }\n\n        protected override void OnDetachingFrom(VisualElement bindable)\n        {\n            _associatedObject = null;\n            base.OnDetachingFrom(bindable);\n        }\n\n        private static void OnIsRotatingChanged(BindableObject bindable, object oldValue, object newValue)\n        {\n            var behavior = (RotationBehavior)bindable;\n\n            if (behavior._associatedObject == null)\n                return;\n\n            if ((bool)newValue)\n            {\n                behavior.StartRotationAnimation();\n            }\n            else\n            {\n                behavior.StopRotationAnimation();\n            }\n        }\n\n        private void StartRotationAnimation()\n        {\n            if (_associatedObject == null) return;\n\n            // Döndürme animasyonunu başlat\n            Microsoft.Maui.Controls.ViewExtensions.CancelAnimations(_associatedObject);\n\n            _associatedObject.Animate(\n                "Rotation",\n                animation: new Animation(v => _associatedObject.Rotation = v, 0, 360),\n                length: Duration,\n                easing: Easing.Linear,\n                repeat: () => IsRotating\n            );\n        }\n\n        private void StopRotationAnimation()\n        {\n            if (_associatedObject == null) return;\n            Microsoft.Maui.Controls.ViewExtensions.CancelAnimations(_associatedObject);\n        }\n    }\n}\n