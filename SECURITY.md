# SECURITY.md\n\n## GÃ¼venlik PolitikasÄ± ve ProsedÃ¼rleri\n\nBu dokÃ¼manda KesifUygulamasiTemplate projesinin gÃ¼venlik politikalarÄ±, token doÄŸrulama prosedÃ¼rleri ve gÃ¼venlik en iyi uygulamalarÄ± aÃ§Ä±klanmaktadÄ±r.\n\n## ğŸ” GÃ¼venlik Genel BakÄ±ÅŸ\n\n### Desteklenen Kimlik DoÄŸrulama TÃ¼rleri\n\n1. **JWT (JSON Web Tokens)**\n   - HS256 algoritmasÄ± ile imzalanmÄ±ÅŸ token'lar\n   - 24 saatlik maksimum geÃ§erlilik sÃ¼resi\n   - Zorunlu claim'ler: `iss`, `aud`, `exp`, `iat`, `sub`\n\n2. **OAuth 2.0**\n   - Authorization Code Grant akÄ±ÅŸÄ±\n   - PKCE (Proof Key for Code Exchange) desteÄŸi\n   - Refresh token rotasyonu\n\n3. **API Keys**\n   - HMAC-SHA256 ile imzalanmÄ±ÅŸ istekler\n   - Rate limiting ve kullanÄ±m takibi\n   - DÃ¼zenli rotasyon politikasÄ±\n\n## ğŸ›¡ï¸ Token DoÄŸrulama ProsedÃ¼rleri\n\n### JWT Token DoÄŸrulama\n\n#### 1. Token YapÄ±sÄ± KontrolÃ¼\n```csharp\n// JWT token yapÄ±sÄ± kontrolÃ¼\npublic bool ValidateJwtStructure(string token)\n{\n    try\n    {\n        var parts = token.Split('.');\n        if (parts.Length != 3)\n            return false;\n\n        // Header, Payload ve Signature bÃ¶lÃ¼mlerinin base64url formatÄ±nda olduÄŸunu kontrol et\n        foreach (var part in parts)\n        {\n            Convert.FromBase64String(part.Replace('-', '+').Replace('_', '/'));\n        }\n\n        return true;\n    }\n    catch\n    {\n        return false;\n    }\n}\n```\n\n#### 2. Token Ä°mza DoÄŸrulama\n```csharp\n// JWT imza doÄŸrulama\npublic bool ValidateJwtSignature(string token, string secretKey)\n{\n    try\n    {\n        var tokenHandler = new JwtSecurityTokenHandler();\n        var validationParameters = new TokenValidationParameters\n        {\n            ValidateIssuer = true,\n            ValidateAudience = true,\n            ValidateLifetime = true,\n            ValidateIssuerSigningKey = true,\n            ValidIssuer = _configuration["Jwt:Issuer"],\n            ValidAudience = _configuration["Jwt:Audience"],\n            IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(secretKey)),\n            ClockSkew = TimeSpan.Zero\n        };\n\n        tokenHandler.ValidateToken(token, validationParameters, out _);\n        return true;\n    }\n    catch\n    {\n        return false;\n    }\n}\n```\n\n#### 3. Token Claim DoÄŸrulama\n```csharp\n// JWT claim doÄŸrulama\npublic bool ValidateJwtClaims(JwtSecurityToken jwtToken)\n{\n    // Zorunlu claim'leri kontrol et\n    if (string.IsNullOrEmpty(jwtToken.Issuer))\n        return false;\n\n    if (string.IsNullOrEmpty(jwtToken.Audience))\n        return false;\n\n    if (jwtToken.ValidTo < DateTime.UtcNow)\n        return false;\n\n    // Ã–zel claim'leri kontrol et\n    var userId = jwtToken.Claims.FirstOrDefault(c => c.Type == "userId")?.Value;\n    if (string.IsNullOrEmpty(userId))\n        return false;\n\n    var role = jwtToken.Claims.FirstOrDefault(c => c.Type == "role")?.Value;\n    if (string.IsNullOrEmpty(role))\n        return false;\n\n    return true;\n}\n```\n\n### OAuth Token DoÄŸrulama\n\n#### 1. Access Token DoÄŸrulama\n```csharp\n// OAuth access token doÄŸrulama\npublic async Task<bool> ValidateOAuthToken(string accessToken)\n{\n    try\n    {\n        using var client = new HttpClient();\n        var request = new HttpRequestMessage(HttpMethod.Get, $"{_oauthAuthority}/oauth2/v2.0/token");\n        request.Headers.Authorization = new AuthenticationHeaderValue("Bearer", accessToken);\n\n        var response = await client.SendAsync(request);\n        return response.IsSuccessStatusCode;\n    }\n    catch\n    {\n        return false;\n    }\n}\n```\n\n#### 2. Refresh Token Rotasyonu\n```csharp\n// Refresh token rotasyonu\npublic async Task<TokenResponse> RotateRefreshToken(string refreshToken)\n{\n    var tokenRequest = new Dictionary<string, string>\n    {\n        ["grant_type"] = "refresh_token",\n        ["refresh_token"] = refreshToken,\n        ["client_id"] = _configuration["OAuth:ClientId"],\n        ["client_secret"] = _configuration["OAuth:ClientSecret"]\n    };\n\n    using var client = new HttpClient();\n    var response = await client.PostAsync($"{_oauthAuthority}/oauth2/v2.0/token",\n        new FormUrlEncodedContent(tokenRequest));\n\n    if (response.IsSuccessStatusCode)\n    {\n        var tokenResponse = await response.Content.ReadFromJsonAsync<TokenResponse>();\n        return tokenResponse;\n    }\n\n    throw new SecurityException("Token rotation failed");\n}\n```\n\n### API Key DoÄŸrulama\n\n#### 1. HMAC Ä°mza DoÄŸrulama\n```csharp\n// API key HMAC imza doÄŸrulama\npublic bool ValidateApiKeySignature(string apiKey, string signature, string payload, string timestamp)\n{\n    try\n    {\n        // Timestamp kontrolÃ¼ (5 dakika tolerans)\n        var requestTime = DateTimeOffset.FromUnixTimeSeconds(long.Parse(timestamp));\n        var currentTime = DateTimeOffset.UtcNow;\n\n        if (Math.Abs((currentTime - requestTime).TotalMinutes) > 5)\n            return false;\n\n        // HMAC-SHA256 imza oluÅŸtur\n        using var hmac = new HMACSHA256(Encoding.UTF8.GetBytes(apiKey));\n        var message = $"{payload}.{timestamp}";\n        var expectedSignature = Convert.ToBase64String(hmac.ComputeHash(Encoding.UTF8.GetBytes(message)));\n\n        return CryptographicOperations.FixedTimeEquals(\n            Encoding.UTF8.GetBytes(signature),\n            Encoding.UTF8.GetBytes(expectedSignature));\n    }\n    catch\n    {\n        return false;\n    }\n}\n```\n\n#### 2. API Key Rate Limiting\n```csharp\n// API key rate limiting\npublic class ApiKeyRateLimiter\n{\n    private readonly ConcurrentDictionary<string, RateLimitInfo> _rateLimits = new();\n    private readonly int _maxRequestsPerHour = 1000;\n\n    public bool IsAllowed(string apiKey)\n    {\n        var now = DateTime.UtcNow;\n        var key = $"{apiKey}:{now.ToString("yyyy-MM-dd-HH")}";\n\n        var rateLimit = _rateLimits.GetOrAdd(key, _ => new RateLimitInfo\n        {\n            WindowStart = now,\n            RequestCount = 0\n        });\n\n        if ((now - rateLimit.WindowStart).TotalHours >= 1)\n        {\n            rateLimit.WindowStart = now;\n            rateLimit.RequestCount = 0;\n        }\n\n        if (rateLimit.RequestCount >= _maxRequestsPerHour)\n            return false;\n\n        rateLimit.RequestCount++;\n        return true;\n    }\n}\n```\n\n## ğŸ”’ GÃ¼venlik KonfigÃ¼rasyonu\n\n### Environment Variables\n\n```bash\n# JWT Configuration\nJWT_SECRET_KEY=your-256-bit-secret-key-here\nJWT_ISSUER=https://your-app.com\nJWT_AUDIENCE=https://your-app.com\nJWT_EXPIRATION_MINUTES=1440\n\n# OAuth Configuration\nOAUTH_CLIENT_ID=your-oauth-client-id\nOAUTH_CLIENT_SECRET=your-oauth-client-secret\nOAUTH_AUTHORITY=https://login.microsoftonline.com/your-tenant-id\n\n# API Keys\nGOOGLE_MAPS_API_KEY=your-google-maps-api-key\nMAPBOX_ACCESS_TOKEN=your-mapbox-access-token\nHERE_API_KEY=your-here-api-key\n\n# Security Settings\nSECURITY_AUDIT_ENABLED=true\nSECURITY_REPORTS_PATH=security-reports\nSECURITY_SCORE_THRESHOLD=80\n```\n\n### appsettings.json KonfigÃ¼rasyonu\n\n```json\n{\n  "Jwt": {\n    "SecretKey": "your-256-bit-secret-key-here",\n    "Issuer": "https://your-app.com",\n    "Audience": "https://your-app.com",\n    "ExpirationMinutes": 1440\n  },\n  "OAuth": {\n    "ClientId": "your-oauth-client-id",\n    "ClientSecret": "your-oauth-client-secret",\n    "Authority": "https://login.microsoftonline.com/your-tenant-id",\n    "RedirectUris": [\n      "https://your-app.com/auth/callback"\n    ]\n  },\n  "SecurityHeaders": {\n    "XContentTypeOptions": "nosniff",\n    "XFrameOptions": "DENY",\n    "XXSSProtection": "1; mode=block",\n    "StrictTransportSecurity": "max-age=31536000; includeSubDomains"\n  },\n  "Cors": {\n    "AllowedOrigins": [\n      "https://your-app.com",\n      "https://app.your-app.com"\n    ],\n    "AllowedHeaders": [\n      "Authorization",\n      "Content-Type",\n      "X-Requested-With"\n    ],\n    "AllowedMethods": [\n      "GET",\n      "POST",\n      "PUT",\n      "DELETE",\n      "OPTIONS"\n    ]\n  }\n}\n```\n\n## ğŸš¨ GÃ¼venlik OlaylarÄ± ve MÃ¼dahale\n\n### GÃ¼venlik Ä°hlali Tespiti\n\n1. **ÅÃ¼pheli Aktivite Tespiti**\n   - Ã‡ok sayÄ±da baÅŸarÄ±sÄ±z giriÅŸ denemesi\n   - Anormal API kullanÄ±m paternleri\n   - ÅÃ¼pheli IP adreslerinden gelen istekler\n\n2. **Otomatik MÃ¼dahale**\n   - Hesap geÃ§ici olarak kilitleme\n   - IP adresi bloklama\n   - GÃ¼venlik olay loglama\n\n3. **Manuel Ä°nceleme**\n   - GÃ¼venlik loglarÄ±nÄ±n analizi\n   - KullanÄ±cÄ± davranÄ±ÅŸ paternlerinin incelenmesi\n   - Sistem eriÅŸim loglarÄ±nÄ±n kontrolÃ¼\n\n### GÃ¼venlik Olay MÃ¼dahale ProsedÃ¼rÃ¼\n\n```csharp\n// GÃ¼venlik olay loglama\npublic async Task LogSecurityEvent(SecurityEvent securityEvent)\n{\n    var logEntry = new SecurityLogEntry\n    {\n        EventType = securityEvent.Type,\n        Severity = securityEvent.Severity,\n        UserId = securityEvent.UserId,\n        IpAddress = securityEvent.IpAddress,\n        UserAgent = securityEvent.UserAgent,\n        Details = securityEvent.Details,\n        Timestamp = DateTime.UtcNow\n    };\n\n    // GÃ¼venlik olayÄ±nÄ± veritabanÄ±na kaydet\n    await _securityLogRepository.AddAsync(logEntry);\n\n    // Kritik olaylarda bildirim gÃ¶nder\n    if (securityEvent.Severity == SecuritySeverity.Critical)\n    {\n        await _notificationService.SendSecurityAlert(logEntry);\n    }\n}\n```\n\n## ğŸ“Š GÃ¼venlik Ä°zleme ve Raporlama\n\n### GÃ¼venlik Metrikleri\n\n- **Kimlik DoÄŸrulama BaÅŸarÄ± OranÄ±**: BaÅŸarÄ±lÄ±/Toplam giriÅŸ denemeleri\n- **Token GeÃ§erlilik SÃ¼resi**: Ortalama token kullanÄ±m sÃ¼resi\n- **API KullanÄ±m Paternleri**: Saatlik/daily API Ã§aÄŸrÄ± istatistikleri\n- **GÃ¼venlik Olay SayÄ±sÄ±**: GÃ¼nlÃ¼k/haftalÄ±k gÃ¼venlik olay istatistikleri\n\n### GÃ¼venlik RaporlarÄ±\n\n```powershell\n# GÃ¼venlik denetimi Ã§alÄ±ÅŸtÄ±rma\n.\scripts\SecurityAudit.ps1 -EnableDetailedAudit -GenerateHtmlReport\n\n# SonuÃ§lar:\n# - security-reports/security-audit-summary.json\n# - security-reports/security-audit-report.html\n```\n\n## ğŸ”„ DÃ¼zenli GÃ¼venlik Kontrolleri\n\n### HaftalÄ±k Kontroller\n- [ ] Token expiration kontrolÃ¼\n- [ ] API key rotasyon kontrolÃ¼\n- [ ] GÃ¼venlik log analizi\n- [ ] BaÄŸÄ±mlÄ±lÄ±k gÃ¼ncellemeleri kontrolÃ¼\n\n### AylÄ±k Kontroller\n- [ ] Tam gÃ¼venlik taramasÄ±\n- [ ] Penetration testing\n- [ ] GÃ¼venlik politika gÃ¼ncellemeleri\n- [ ] Sertifika geÃ§erlilik kontrolÃ¼\n\n### YÄ±llÄ±k Kontroller\n- [ ] GÃ¼venlik mimarisi review\n- [ ] ÃœÃ§Ã¼ncÃ¼ parti baÄŸÄ±mlÄ±lÄ±k audit\n- [ ] GÃ¼venlik eÄŸitim gÃ¼ncellemeleri\n\n## ğŸ“ Ä°letiÅŸim ve Destek\n\nGÃ¼venlik sorunlarÄ± iÃ§in:\n- **Email**: security@your-app.com\n- **Response Time**: Kritik sorunlar iÃ§in 1 saat, diÄŸerleri iÃ§in 24 saat\n- **PGP Key**: GÃ¼venlik raporlarÄ± iÃ§in ÅŸifreleme anahtarÄ±\n\n## ğŸ“ DeÄŸiÅŸiklik GeÃ§miÅŸi\n\n| Tarih | SÃ¼rÃ¼m | DeÄŸiÅŸiklik |\n|-------|--------|------------|\n| 2024-01-15 | 1.0 | Ä°lk gÃ¼venlik politikasÄ± |\n| 2024-01-20 | 1.1 | JWT ve OAuth prosedÃ¼rleri eklendi |\n| 2024-01-25 | 1.2 | API key doÄŸrulama prosedÃ¼rleri eklendi |\n| 2024-02-01 | 1.3 | GÃ¼venlik olay mÃ¼dahale prosedÃ¼rleri eklendi |\n\n---\n\n**Son GÃ¼ncelleme**: 2024-02-01\n**SÃ¼rÃ¼m**: 1.3\n**DokÃ¼ment Sahibi**: GÃ¼venlik Ekibi\n