# Test-TileOptimization.ps1 - Tile optimizasyon test scripti\n# CI/CD pipeline ile entegre edilmiÅŸ offline tile compression ve prefetch testi\n\nparam(\n    [string]$TestEnvironment = "local",\n    [string]$Configuration = "Debug",\n    [string]$ProjectPath = $PSScriptRoot,\n    [switch]$SkipBuild,\n    [switch]$Verbose,\n    [switch]$ExportJson,\n    [string]$CachePath = "cache\tiles",\n    [string]$CompressedPath = "cache\compressed",\n    [int]$TestTileCount = 100,\n    [int]$CompressionLevel = 6\n)\n\n# Script ayarlarÄ±\n$ErrorActionPreference = "Stop"\n$VerbosePreference = if ($Verbose) { "Continue" } else { "SilentlyContinue" }\n\n# Test sonuÃ§larÄ± iÃ§in deÄŸiÅŸkenler\n$testResults = @{\n    TotalTests = 0\n    PassedTests = 0\n    FailedTests = 0\n    TestDuration = [TimeSpan]::Zero\n    Details = @()\n    CompressionStats = @{\n        OriginalSize = 0\n        CompressedSize = 0\n        CompressionRatio = 0\n        TilesCompressed = 0\n    }\n    PrefetchStats = @{\n        TilesPrefetched = 0\n        PrefetchDuration = [TimeSpan]::Zero\n        CacheHitRate = 0\n    }\n}\n\n# Environment deÄŸiÅŸkenlerini ayarla\n$env:TEST_ENVIRONMENT = $TestEnvironment\n$env:CI = if ($TestEnvironment -eq "ci") { "true" } else { "false" }\n$env:TILE_CACHE_PATH = $CachePath\n$env:COMPRESSED_TILE_PATH = $CompressedPath\n$env:COMPRESSION_LEVEL = $CompressionLevel.ToString()\n$env:ENABLE_TILE_COMPRESSION = "true"\n$env:MAX_TILE_SIZE_MB = "10"\n$env:ENABLE_PREFETCH = "true"\n$env:MAX_CONCURRENT_DOWNLOADS = "3"\n$env:PREFETCH_RADIUS = "2"\n\n# Renkli output iÃ§in\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = "White"\n    )\n    Write-Host $Message -ForegroundColor $Color\n}\n\n# BaÅŸlÄ±k\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "      ğŸ—ºï¸ Tile Optimizasyon Test Sistemi" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput ""\n\n# Proje yolunu kontrol et\nif (!(Test-Path $ProjectPath)) {\n    Write-ColorOutput "Hata: Proje yolu bulunamadÄ±: $ProjectPath" "Red"\n    exit 1\n}\n\n# Test fonksiyonlarÄ±\nfunction Test-TileOptimization {\n    param(\n        [string]$TestName,\n        [scriptblock]$TestScript\n    )\n\n    $startTime = Get-Date\n    $testPassed = $false\n    $errorMessage = ""\n\n    Write-ColorOutput "ğŸ§ª $TestName testi baÅŸlatÄ±lÄ±yor..." "White"\n\n    try {\n        & $TestScript\n        $testPassed = $true\n        Write-ColorOutput "  âœ… $TestName testi baÅŸarÄ±lÄ±" "Green"\n    } catch {\n        $errorMessage = $_.Exception.Message\n        Write-ColorOutput "  âŒ $TestName testi baÅŸarÄ±sÄ±z: $errorMessage" "Red"\n    } finally {\n        $endTime = Get-Date\n        $duration = $endTime - $startTime\n\n        $testResults.TotalTests++\n        if ($testPassed) {\n            $testResults.PassedTests++\n        } else {\n            $testResults.FailedTests++\n        }\n        $testResults.TestDuration += $duration\n\n        $testResults.Details += @{\n            TestName = $TestName\n            Passed = $testPassed\n            Duration = $duration\n            ErrorMessage = $errorMessage\n        }\n    }\n}\n\n# Cache klasÃ¶rÃ¼ oluÅŸturma testi\nfunction Test-CacheDirectorySetup {\n    Write-ColorOutput "  ğŸ“ Cache klasÃ¶rÃ¼ kurulumu kontrol ediliyor..." "Gray"\n\n    $fullCachePath = Join-Path $ProjectPath $CachePath\n    $fullCompressedPath = Join-Path $ProjectPath $CompressedPath\n\n    if (!(Test-Path $fullCachePath)) {\n        Write-ColorOutput "    ğŸ“‚ Cache klasÃ¶rÃ¼ oluÅŸturuluyor: $fullCachePath" "Gray"\n        New-Item -ItemType Directory -Path $fullCachePath -Force | Out-Null\n    } else {\n        Write-ColorOutput "    âœ… Cache klasÃ¶rÃ¼ mevcut: $fullCachePath" "Green"\n    }\n\n    if (!(Test-Path $fullCompressedPath)) {\n        Write-ColorOutput "    ğŸ“‚ SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ cache klasÃ¶rÃ¼ oluÅŸturuluyor: $fullCompressedPath" "Gray"\n        New-Item -ItemType Directory -Path $fullCompressedPath -Force | Out-Null\n    } else {\n        Write-ColorOutput "    âœ… SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ cache klasÃ¶rÃ¼ mevcut: $fullCompressedPath" "Green"\n    }\n\n    # Test tile dosyasÄ± oluÅŸtur\n    $testTilePath = Join-Path $fullCachePath "test-tile.png"\n    $testData = [byte[]]::new(1024) # 1KB test verisi\n    [System.Random]::new().NextBytes($testData)\n    [System.IO.File]::WriteAllBytes($testTilePath, $testData)\n\n    if (Test-Path $testTilePath) {\n        Write-ColorOutput "    âœ… Test tile dosyasÄ± oluÅŸturuldu" "Green"\n        Remove-Item $testTilePath -Force\n    } else {\n        Write-ColorOutput "    âŒ Test tile dosyasÄ± oluÅŸturulamadÄ±" "Red"\n        throw "Cache directory setup failed"\n    }\n}\n\n# Tile sÄ±kÄ±ÅŸtÄ±rma testi\nfunction Test-TileCompression {\n    Write-ColorOutput "  ğŸ—œï¸ Tile sÄ±kÄ±ÅŸtÄ±rma testi baÅŸlatÄ±lÄ±yor..." "Gray"\n\n    $fullCachePath = Join-Path $ProjectPath $CachePath\n    $fullCompressedPath = Join-Path $ProjectPath $CompressedPath\n\n    # Test tile'larÄ± oluÅŸtur\n    $testTiles = @()\n    for ($i = 1; $i -le 10; $i++) {\n        $tileData = [byte[]]::new(2048 + ($i * 100)) # FarklÄ± boyutlarda tile'lar\n        [System.Random]::new().NextBytes($tileData)\n\n        $tileKey = "15/1234/5678_$i"\n        $testTiles += @{\n            Key = $tileKey\n            Data = $tileData\n            OriginalSize = $tileData.Length\n        }\n    }\n\n    $totalOriginalSize = 0\n    $totalCompressedSize = 0\n    $compressedTiles = 0\n\n    foreach ($tile in $testTiles) {\n        try {\n            # GZip sÄ±kÄ±ÅŸtÄ±rma simÃ¼lasyonu\n            $compressedData = Compress-TileData $tile.Data\n            $totalOriginalSize += $tile.OriginalSize\n            $totalCompressedSize += $compressedData.Length\n            $compressedTiles++\n\n            # SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ dosyayÄ± kaydet\n            $compressedFilePath = Get-CompressedTilePath $tile.Key $fullCompressedPath\n            $directory = [System.IO.Path]::GetDirectoryName($compressedFilePath)\n            if (!(Test-Path $directory)) {\n                New-Item -ItemType Directory -Path $directory -Force | Out-Null\n            }\n            [System.IO.File]::WriteAllBytes($compressedFilePath, $compressedData)\n\n            Write-ColorOutput "    ğŸ“¦ Tile sÄ±kÄ±ÅŸtÄ±rÄ±ldÄ±: $($tile.Key) ($($tile.OriginalSize) -> $($compressedData.Length) bytes)" "Gray"\n        } catch {\n            Write-ColorOutput "    âŒ Tile sÄ±kÄ±ÅŸtÄ±rma hatasÄ±: $($tile.Key) - $($_.Exception.Message)" "Red"\n        }\n    }\n\n    # SÄ±kÄ±ÅŸtÄ±rma istatistiklerini hesapla\n    $compressionRatio = if ($totalOriginalSize -gt 0) { $totalCompressedSize / $totalOriginalSize } else { 0 }\n    $spaceSaved = $totalOriginalSize - $totalCompressedSize\n\n    Write-ColorOutput "    ğŸ“Š SÄ±kÄ±ÅŸtÄ±rma Ä°statistikleri:" "Gray"\n    Write-ColorOutput "      - SÄ±kÄ±ÅŸtÄ±rÄ±lan Tile: $compressedTiles" "Gray"\n    Write-ColorOutput "      - Orijinal Boyut: $([math]::Round($totalOriginalSize/1024, 2)) KB" "Gray"\n    Write-ColorOutput "      - SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Boyut: $([math]::Round($totalCompressedSize/1024, 2)) KB" "Gray"\n    Write-ColorOutput "      - SÄ±kÄ±ÅŸtÄ±rma OranÄ±: $([math]::Round($compressionRatio, 3))" "Gray"\n    Write-ColorOutput "      - Tasarruf: $([math]::Round($spaceSaved/1024, 2)) KB" "Green"\n\n    # Test sonuÃ§larÄ±nÄ± gÃ¼ncelle\n    $testResults.CompressionStats.OriginalSize = $totalOriginalSize\n    $testResults.CompressionStats.CompressedSize = $totalCompressedSize\n    $testResults.CompressionStats.CompressionRatio = $compressionRatio\n    $testResults.CompressionStats.TilesCompressed = $compressedTiles\n\n    if ($compressionRatio -lt 1) {\n        Write-ColorOutput "    âœ… Tile sÄ±kÄ±ÅŸtÄ±rma baÅŸarÄ±lÄ±" "Green"\n    } else {\n        Write-ColorOutput "    âš ï¸  SÄ±kÄ±ÅŸtÄ±rma etkisi sÄ±nÄ±rlÄ±" "Yellow"\n    }\n}\n\n# Tile aÃ§ma testi\nfunction Test-TileDecompression {\n    Write-ColorOutput "  ğŸ“¤ Tile aÃ§ma testi baÅŸlatÄ±lÄ±yor..." "Gray"\n\n    $fullCompressedPath = Join-Path $ProjectPath $CompressedPath\n    $decompressedTiles = 0\n    $totalDecompressedSize = 0\n\n    # SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ tile dosyalarÄ±nÄ± bul\n    $compressedFiles = Get-ChildItem $fullCompressedPath -Filter "*.tile" -Recurse\n\n    foreach ($file in $compressedFiles) {\n        try {\n            $compressedData = [System.IO.File]::ReadAllBytes($file.FullName)\n            $decompressedData = Decompress-TileData $compressedData\n\n            $totalDecompressedSize += $decompressedData.Length\n            $decompressedTiles++\n\n            Write-ColorOutput "    ğŸ“¦ Tile aÃ§Ä±ldÄ±: $($file.Name) ($($compressedData.Length) -> $($decompressedData.Length) bytes)" "Gray"\n        } catch {\n            Write-ColorOutput "    âŒ Tile aÃ§ma hatasÄ±: $($file.Name) - $($_.Exception.Message)" "Red"\n        }\n    }\n\n    Write-ColorOutput "    ğŸ“Š AÃ§ma Ä°statistikleri:" "Gray"\n    Write-ColorOutput "      - AÃ§Ä±lan Tile: $decompressedTiles" "Gray"\n    Write-ColorOutput "      - Toplam Boyut: $([math]::Round($totalDecompressedSize/1024, 2)) KB" "Gray"\n\n    if ($decompressedTiles -gt 0) {\n        Write-ColorOutput "    âœ… Tile aÃ§ma baÅŸarÄ±lÄ±" "Green"\n    } else {\n        Write-ColorOutput "    âŒ HiÃ§ tile aÃ§Ä±lmadÄ±" "Red"\n        throw "Tile decompression failed"\n    }\n}\n\n# Prefetch testi\nfunction Test-TilePrefetch {\n    Write-ColorOutput "  ğŸš€ Tile prefetch testi baÅŸlatÄ±lÄ±yor..." "Gray"\n\n    $prefetchStartTime = Get-Date\n\n    # Mock rota noktalarÄ± oluÅŸtur\n    $routePoints = @()\n    for ($i = 0; $i -lt 20; $i++) {\n        $routePoints += @{\n            Lat = 41.0082 + ($i * 0.001)  # Ä°stanbul koordinatlarÄ± etrafÄ±nda\n            Lng = 28.9784 + ($i * 0.001)\n        }\n    }\n\n    $prefetchedTiles = 0\n    $zoomLevels = @(10, 12, 15)\n\n    foreach ($point in $routePoints) {\n        foreach ($zoom in $zoomLevels) {\n            # Tile koordinatlarÄ±nÄ± hesapla (basitleÅŸtirilmiÅŸ)\n            $tileX = [math]::Floor(($point.Lng + 180) / 360 * [math]::Pow(2, $zoom))\n            $tileY = [math]::Floor((1 - [math]::Log([math]::Tan($point.Lat * [math]::PI / 180) + 1 / [math]::Cos($point.Lat * [math]::PI / 180)) / [math]::PI) / 2 * [math]::Pow(2, $zoom))\n\n            $tileKey = "$zoom/$tileX/$tileY"\n\n            # Prefetch simÃ¼lasyonu\n            Write-ColorOutput "    ğŸ“¦ Prefetching tile: $tileKey" "Gray"\n            $prefetchedTiles++\n\n            # KÄ±sa bir gecikme ekle (aÄŸ Ã§aÄŸrÄ±sÄ± simÃ¼lasyonu)\n            Start-Sleep -Milliseconds 10\n        }\n    }\n\n    $prefetchEndTime = Get-Date\n    $prefetchDuration = $prefetchEndTime - $prefetchStartTime\n\n    Write-ColorOutput "    ğŸ“Š Prefetch Ä°statistikleri:" "Gray"\n    Write-ColorOutput "      - Prefetch Edilen Tile: $prefetchedTiles" "Gray"\n    Write-ColorOutput "      - SÃ¼re: $([math]::Round($prefetchDuration.TotalSeconds, 2)) saniye" "Gray"\n    Write-ColorOutput "      - Saniye BaÅŸÄ±na Tile: $([math]::Round($prefetchedTiles / $prefetchDuration.TotalSeconds, 1))" "Gray"\n\n    # Test sonuÃ§larÄ±nÄ± gÃ¼ncelle\n    $testResults.PrefetchStats.TilesPrefetched = $prefetchedTiles\n    $testResults.PrefetchStats.PrefetchDuration = $prefetchDuration\n    $testResults.PrefetchStats.CacheHitRate = 0.75 # Mock cache hit rate\n\n    if ($prefetchedTiles -gt 0) {\n        Write-ColorOutput "    âœ… Tile prefetch baÅŸarÄ±lÄ±" "Green"\n    } else {\n        Write-ColorOutput "    âŒ Prefetch baÅŸarÄ±sÄ±z" "Red"\n        throw "Tile prefetch failed"\n    }\n}\n\n# Cache temizleme testi\nfunction Test-CacheCleanup {\n    Write-ColorOutput "  ğŸ§¹ Cache temizleme testi baÅŸlatÄ±lÄ±yor..." "Gray"\n\n    $fullCachePath = Join-Path $ProjectPath $CachePath\n    $fullCompressedPath = Join-Path $ProjectPath $CompressedPath\n\n    # Eski test dosyalarÄ± oluÅŸtur\n    $oldFiles = @()\n    $oldDate = (Get-Date).AddDays(-8) # 8 gÃ¼n Ã¶nce\n\n    for ($i = 1; $i -le 5; $i++) {\n        $oldFileName = "old-tile-$i.tile"\n        $oldFilePath = Join-Path $fullCompressedPath $oldFileName\n        "old test data $i" | Out-File $oldFilePath -Encoding UTF8\n        (Get-Item $oldFilePath).LastWriteTime = $oldDate\n        $oldFiles += $oldFilePath\n    }\n\n    # Yeni test dosyasÄ± oluÅŸtur\n    $newFileName = "new-tile.tile"\n    $newFilePath = Join-Path $fullCompressedPath $newFileName\n    "new test data" | Out-File $newFilePath -Encoding UTF8\n\n    Write-ColorOutput "    ğŸ“… Eski dosyalar oluÅŸturuldu: $($oldFiles.Count)" "Gray"\n    Write-ColorOutput "    ğŸ“… Yeni dosya oluÅŸturuldu: $newFileName" "Gray"\n\n    # Eski dosyalarÄ± temizle (7 gÃ¼nden eski)\n    $retentionDays = 7\n    $cutoffDate = (Get-Date).AddDays(-$retentionDays)\n\n    $filesToDelete = Get-ChildItem $fullCompressedPath -Filter "*.tile" |\n        Where-Object { $_.LastWriteTime -lt $cutoffDate }\n\n    $deletedCount = 0\n    foreach ($file in $filesToDelete) {\n        Remove-Item $file.FullName -Force\n        $deletedCount++\n        Write-ColorOutput "    âœ… Eski dosya silindi: $($file.Name)" "Green"\n    }\n\n    # Yeni dosyanÄ±n kaldÄ±ÄŸÄ±nÄ± kontrol et\n    if (Test-Path $newFilePath) {\n        Write-ColorOutput "    âœ… Yeni dosya korundu" "Green"\n    } else {\n        Write-ColorOutput "    âŒ Yeni dosya yanlÄ±ÅŸlÄ±kla silindi" "Red"\n    }\n\n    Write-ColorOutput "    ğŸ“Š Temizleme Ä°statistikleri:" "Gray"\n    Write-ColorOutput "      - Silinen Dosya: $deletedCount" "Gray"\n    Write-ColorOutput "      - Korunan Dosya: 1" "Gray"\n}\n\n# YardÄ±mcÄ± fonksiyonlar\nfunction Compress-TileData {\n    param([byte[]]$data)\n\n    $memoryStream = New-Object System.IO.MemoryStream\n    $gzipStream = New-Object System.IO.Compression.GZipStream($memoryStream, [System.IO.Compression.CompressionMode]::Compress)\n    $gzipStream.Write($data, 0, $data.Length)\n    $gzipStream.Close()\n    return $memoryStream.ToArray()\n}\n\nfunction Decompress-TileData {\n    param([byte[]]$compressedData)\n\n    $inputStream = New-Object System.IO.MemoryStream($compressedData)\n    $outputStream = New-Object System.IO.MemoryStream\n    $gzipStream = New-Object System.IO.Compression.GZipStream($inputStream, [System.IO.Compression.CompressionMode]::Decompress)\n    $gzipStream.CopyTo($outputStream)\n    $gzipStream.Close()\n    return $outputStream.ToArray()\n}\n\nfunction Get-CompressedTilePath {\n    param([string]$tileKey, [string]$compressedPath)\n\n    $parts = $tileKey -split "/"\n    if ($parts.Length -ge 3) {\n        $z = $parts[0]\n        $x = $parts[1].PadLeft(4, '0')\n        $y = $parts[2].PadLeft(4, '0')\n\n        $tilePath = Join-Path $compressedPath $z\n        $tilePath = Join-Path $tilePath $x.Substring(0, 2)\n        $tilePath = Join-Path $tilePath $x.Substring(2, 2)\n        $tilePath = Join-Path $tilePath "$x_$y.tile"\n\n        return $tilePath\n    }\n\n    return Join-Path $compressedPath "$($tileKey -replace '/', '_').tile"\n}\n\n# Ana test dÃ¶ngÃ¼sÃ¼\nWrite-ColorOutput "ğŸš€ Tile optimizasyon testleri baÅŸlatÄ±lÄ±yor..." "White"\nWrite-ColorOutput ""\n\n# Testleri Ã§alÄ±ÅŸtÄ±r\nTest-TileOptimization -TestName "Cache KlasÃ¶rÃ¼ Kurulumu" -TestScript { Test-CacheDirectorySetup }\nTest-TileOptimization -TestName "Tile SÄ±kÄ±ÅŸtÄ±rma" -TestScript { Test-TileCompression }\nTest-TileOptimization -TestName "Tile AÃ§ma" -TestScript { Test-TileDecompression }\nTest-TileOptimization -TestName "Tile Prefetch" -TestScript { Test-TilePrefetch }\nTest-TileOptimization -TestName "Cache Temizleme" -TestScript { Test-CacheCleanup }\n\n# Test Ã¶zeti\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "           ğŸ“Š Test SonuÃ§larÄ±" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\n$successRate = if ($testResults.TotalTests -gt 0) {\n    [math]::Round(($testResults.PassedTests / $testResults.TotalTests) * 100, 1)\n} else { 0 }\n\nWrite-ColorOutput "Toplam Test: $($testResults.TotalTests)" "White"\nWrite-ColorOutput "BaÅŸarÄ±lÄ±: $($testResults.PassedTests)" "Green"\nWrite-ColorOutput "BaÅŸarÄ±sÄ±z: $($testResults.FailedTests)" "Red"\nWrite-ColorOutput "BaÅŸarÄ± OranÄ±: $successRate%" "Cyan"\nWrite-ColorOutput "Toplam SÃ¼re: $($testResults.TestDuration.TotalSeconds) saniye" "White"\n\n# SÄ±kÄ±ÅŸtÄ±rma istatistikleri\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "        ğŸ—œï¸ SÄ±kÄ±ÅŸtÄ±rma Ä°statistikleri" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\nWrite-ColorOutput "SÄ±kÄ±ÅŸtÄ±rÄ±lan Tile: $($testResults.CompressionStats.TilesCompressed)" "White"\nWrite-ColorOutput "Orijinal Boyut: $([math]::Round($testResults.CompressionStats.OriginalSize/1024, 2)) KB" "White"\nWrite-ColorOutput "SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ Boyut: $([math]::Round($testResults.CompressionStats.CompressedSize/1024, 2)) KB" "White"\nWrite-ColorOutput "SÄ±kÄ±ÅŸtÄ±rma OranÄ±: $([math]::Round($testResults.CompressionStats.CompressionRatio, 3))" "Cyan"\nWrite-ColorOutput "Alan Tasarrufu: $([math]::Round(($testResults.CompressionStats.OriginalSize - $testResults.CompressionStats.CompressedSize)/1024, 2)) KB" "Green"\n\n# Prefetch istatistikleri\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "        ğŸš€ Prefetch Ä°statistikleri" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\nWrite-ColorOutput "Prefetch Edilen Tile: $($testResults.PrefetchStats.TilesPrefetched)" "White"\nWrite-ColorOutput "Prefetch SÃ¼resi: $([math]::Round($testResults.PrefetchStats.PrefetchDuration.TotalSeconds, 2)) saniye" "White"\nWrite-ColorOutput "Cache Hit Rate: $([math]::Round($testResults.PrefetchStats.CacheHitRate * 100, 1))%" "Cyan"\n\n# DetaylÄ± sonuÃ§lar\nif ($Verbose) {\n    Write-ColorOutput "" "White"\n    Write-ColorOutput "DetaylÄ± SonuÃ§lar:" "Yellow"\n    foreach ($detail in $testResults.Details) {\n        $status = if ($detail.Passed) { "âœ…" } else { "âŒ" }\n        Write-ColorOutput "  $status $($detail.TestName)" "White"\n        if (!$detail.Passed -and $detail.ErrorMessage) {\n            Write-ColorOutput "    Hata: $($detail.ErrorMessage)" "Red"\n        }\n    }\n}\n\n# JSON export\nif ($ExportJson) {\n    $jsonPath = Join-Path $ProjectPath "tile-optimization-test-results.json"\n    $exportData = @{\n        metadata = @{\n            timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")\n            script_version = "1.0.0"\n            test_environment = $TestEnvironment\n            cache_path = $CachePath\n            compressed_path = $CompressedPath\n            test_tile_count = $TestTileCount\n            compression_level = $CompressionLevel\n            total_duration_seconds = $testResults.TestDuration.TotalSeconds\n        }\n        summary = @{\n            total_tests = $testResults.TotalTests\n            passed_tests = $testResults.PassedTests\n            failed_tests = $testResults.FailedTests\n            success_rate = $successRate\n        }\n        compression_stats = $testResults.CompressionStats\n        prefetch_stats = $testResults.PrefetchStats\n        details = $testResults.Details\n        recommendations = @(\n            "SÄ±kÄ±ÅŸtÄ±rma seviyesini artÄ±rarak daha fazla alan tasarrufu saÄŸlayÄ±n",\n            "Prefetch radius'Ä±nÄ± artÄ±rarak daha iyi offline deneyim sunun",\n            "Cache temizleme periyodunu optimize edin",\n            "Paralel indirme sayÄ±sÄ±nÄ± artÄ±rarak prefetch hÄ±zÄ±nÄ± iyileÅŸtirin",\n            "Tile boyut limitlerini kullanÄ±m paternlerine gÃ¶re ayarlayÄ±n"\n        )\n    }\n\n    $exportData | ConvertTo-Json -Depth 10 | Set-Content $jsonPath\n    Write-ColorOutput "ğŸ“„ Test sonuÃ§larÄ± JSON olarak kaydedildi: $jsonPath" "Green"\n}\n\n# Badge tetikleme\nif ($testResults.PassedTests -gt 0) {\n    Show-Badge "Offline-Optimized"\n}\n\n# Final sonuÃ§\nWrite-ColorOutput "" "White"\nif ($testResults.FailedTests -eq 0) {\n    Write-ColorOutput "ğŸ‰ Tile optimizasyon testleri baÅŸarÄ±lÄ±! Offline sistem hazÄ±r." "Green"\n    exit 0\n} else {\n    Write-ColorOutput "ğŸ’¥ BazÄ± tile optimizasyon testleri baÅŸarÄ±sÄ±z oldu." "Red"\n    exit 1\n}\n\n# Badge gÃ¶sterme fonksiyonu\nfunction Show-Badge {\n    param([string]$BadgeName)\n\n    Write-ColorOutput "ğŸ… Badge kazanÄ±ldÄ±: $BadgeName" "Cyan"\n\n    # Badge dosyasÄ±nÄ± gÃ¼ncelle (varsa)\n    $badgeFile = Join-Path $ProjectPath "badge.json"\n    if (Test-Path $badgeFile) {\n        try {\n            $badgeData = Get-Content $badgeFile -Raw | ConvertFrom-Json\n            if ($badgeData.PSObject.Properties.Name -notcontains $BadgeName) {\n                $badgeData | Add-Member -MemberType NoteProperty -Name $BadgeName -Value $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            } else {\n                $badgeData.$BadgeName = $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            }\n        } catch {\n            Write-ColorOutput "  âš ï¸  Badge dosyasÄ± gÃ¼ncellenemedi" "Yellow"\n        }\n    } else {\n        # Yeni badge dosyasÄ± oluÅŸtur\n        $newBadgeData = @{\n            $BadgeName = $true\n        }\n        $newBadgeData | ConvertTo-Json | Set-Content $badgeFile\n        Write-ColorOutput "  âœ… Yeni badge dosyasÄ± oluÅŸturuldu" "Green"\n    }\n}\n