# Test-Benchmark.ps1 - Dinamik benchmark testi\n# Bu script benchmark sistemini test eder ve CI/CD pipeline ile entegre Ã§alÄ±ÅŸÄ±r\n\nparam(\n    [string]$TestEnvironment = "local",\n    [string]$Configuration = "Debug",\n    [string]$ProjectPath = $PSScriptRoot,\n    [switch]$SkipBuild,\n    [switch]$Verbose,\n    [switch]$ExportJson,\n    [int]$MaxBenchmarkHistory = 1000,\n    [double]$PerformanceThreshold = 0.1,\n    [string[]]$MonitoredMetrics = @("route_calculation", "map_rendering", "tile_loading", "api_response")\n)\n\n# Script ayarlarÄ±\n$ErrorActionPreference = "Stop"\n$VerbosePreference = if ($Verbose) { "Continue" } else { "SilentlyContinue" }\n\n# Test sonuÃ§larÄ± iÃ§in deÄŸiÅŸkenler\n$testResults = @{\n    TotalTests = 0\n    PassedTests = 0\n    FailedTests = 0\n    TestDuration = [TimeSpan]::Zero\n    Details = @()\n}\n\n# Environment deÄŸiÅŸkenlerini ayarla\n$env:TEST_ENVIRONMENT = $TestEnvironment\n$env:CI = if ($TestEnvironment -eq "ci") { "true" } else { "false" }\n$env:AUTO_SAVE_BENCHMARKS = "true"\n$env:MAX_BENCHMARK_HISTORY = $MaxBenchmarkHistory.ToString()\n$env:PERFORMANCE_THRESHOLD = $PerformanceThreshold.ToString()\n$env:MONITORED_METRICS = $MonitoredMetrics -join ","\n\n# Renkli output iÃ§in\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = "White"\n    )\n    Write-Host $Message -ForegroundColor $Color\n}\n\n# BaÅŸlÄ±k\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "      ğŸ“Š Dinamik Benchmark Testi" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput ""\n\n# Proje yolunu kontrol et\nif (!(Test-Path $ProjectPath)) {\n    Write-ColorOutput "Hata: Proje yolu bulunamadÄ±: $ProjectPath" "Red"\n    exit 1\n}\n\n# Test fonksiyonlarÄ±\nfunction Test-BenchmarkSystem {\n    param(\n        [string]$TestName,\n        [scriptblock]$TestScript\n    )\n\n    $startTime = Get-Date\n    $testPassed = $false\n    $errorMessage = ""\n\n    Write-ColorOutput "ğŸ§ª $TestName testi baÅŸlatÄ±lÄ±yor..." "White"\n\n    try {\n        & $TestScript\n        $testPassed = $true\n        Write-ColorOutput "  âœ… $TestName testi baÅŸarÄ±lÄ±" "Green"\n    } catch {\n        $errorMessage = $_.Exception.Message\n        Write-ColorOutput "  âŒ $TestName testi baÅŸarÄ±sÄ±z: $errorMessage" "Red"\n    } finally {\n        $endTime = Get-Date\n        $duration = $endTime - $startTime\n\n        $testResults.TotalTests++\n        if ($testPassed) {\n            $testResults.PassedTests++\n        } else {\n            $testResults.FailedTests++\n        }\n        $testResults.TestDuration += $duration\n\n        $testResults.Details += @{\n            TestName = $TestName\n            Passed = $testPassed\n            Duration = $duration\n            ErrorMessage = $errorMessage\n        }\n    }\n}\n\n# Benchmark veri yapÄ±sÄ± testi\nfunction Test-BenchmarkDataStructure {\n    Write-ColorOutput "  ğŸ“Š Benchmark veri yapÄ±sÄ± test ediliyor..." "Gray"\n\n    # Benchmark veri klasÃ¶rÃ¼ kontrolÃ¼\n    $benchmarkDataPath = Join-Path $env:APPDATA "KesifUygulamasi\BenchmarkData"\n    if (!(Test-Path $benchmarkDataPath)) {\n        New-Item -ItemType Directory -Path $benchmarkDataPath -Force | Out-Null\n        Write-ColorOutput "    ğŸ“ Benchmark veri klasÃ¶rÃ¼ oluÅŸturuldu" "Gray"\n    }\n\n    # Ã–rnek benchmark dosyasÄ± oluÅŸtur\n    $sampleBenchmark = @{\n        metric = "route_calculation"\n        value = 150.5\n        unit = "ms"\n        timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")\n        category = "Navigation"\n        metadata = @{\n            environment = "Test"\n            platform = "Windows"\n            framework = "NET8.0"\n        }\n        isBaseline = $false\n    }\n\n    $benchmarkFile = Join-Path $benchmarkDataPath "benchmark_test_$(Get-Date -Format 'yyyyMMdd_HHmmss').json"\n    $sampleBenchmark | ConvertTo-Json -Depth 10 | Set-Content $benchmarkFile\n\n    Write-ColorOutput "    ğŸ“„ Ã–rnek benchmark dosyasÄ± oluÅŸturuldu: $benchmarkFile" "Gray"\n\n    # JSON validasyonu\n    try {\n        $content = Get-Content $benchmarkFile -Raw | ConvertFrom-Json\n        Write-ColorOutput "    âœ… JSON formatÄ± geÃ§erli" "Green"\n    } catch {\n        Write-ColorOutput "    âŒ JSON format hatasÄ±" "Red"\n        throw\n    }\n}\n\n# Performans Ã¶lÃ§Ã¼mÃ¼ testi\nfunction Test-PerformanceMeasurement {\n    Write-ColorOutput "  â±ï¸  Performans Ã¶lÃ§Ã¼mÃ¼ test ediliyor..." "Gray"\n\n    # Ã–rnek performans metrikleri\n    $testMetrics = @(\n        @{ Name = "route_calculation"; Value = 145.2; Unit = "ms"; Category = "Navigation" },\n        @{ Name = "map_rendering"; Value = 42.8; Unit = "ms"; Category = "UI" },\n        @{ Name = "tile_loading"; Value = 118.5; Unit = "ms"; Category = "Data" },\n        @{ Name = "api_response"; Value = 195.3; Unit = "ms"; Category = "Network" },\n        @{ Name = "database_query"; Value = 23.7; Unit = "ms"; Category = "Data" }\n    )\n\n    foreach ($metric in $testMetrics) {\n        Write-ColorOutput "    ğŸ“ $($metric.Name): $($metric.Value) $($metric.Unit) ($($metric.Category))" "Gray"\n    }\n\n    Write-ColorOutput "    ğŸ“Š Test edilen metrik sayÄ±sÄ±: $($testMetrics.Count)" "Gray"\n}\n\n# Baseline karÅŸÄ±laÅŸtÄ±rma testi\nfunction Test-BaselineComparison {\n    Write-ColorOutput "  ğŸ“ˆ Baseline karÅŸÄ±laÅŸtÄ±rma test ediliyor..." "Gray"\n\n    # Baseline dosyasÄ± oluÅŸtur\n    $benchmarkDataPath = Join-Path $env:APPDATA "KesifUygulamasi\BenchmarkData"\n    $baselineFile = Join-Path $benchmarkDataPath "baselines.json"\n\n    $baselines = @{\n        "route_calculation" = 140.0\n        "map_rendering" = 40.0\n        "tile_loading" = 110.0\n        "api_response" = 180.0\n    }\n\n    $baselines | ConvertTo-Json | Set-Content $baselineFile\n    Write-ColorOutput "    ğŸ“„ Baseline dosyasÄ± oluÅŸturuldu" "Gray"\n\n    # KarÅŸÄ±laÅŸtÄ±rma testi\n    $testValues = @{\n        "route_calculation" = 150.5\n        "map_rendering" = 38.2\n        "tile_loading" = 125.8\n        "api_response" = 175.3\n    }\n\n    foreach ($metric in $testValues.Keys) {\n        $baseline = $baselines[$metric]\n        $current = $testValues[$metric]\n        $deviation = (($current - $baseline) / $baseline) * 100\n\n        $status = if ([Math]::Abs($deviation) -le ($PerformanceThreshold * 100)) { "âœ…" } else { "âš ï¸" }\n        Write-ColorOutput "    $status $metric : ${current}ms (Baseline: ${baseline}ms, Deviation: ${deviation:F2}%)" "Gray"\n    }\n}\n\n# Metrik izleme testi\nfunction Test-MetricMonitoring {\n    Write-ColorOutput "  ğŸ“‹ Metrik izleme test ediliyor..." "Gray"\n\n    $monitoredMetrics = $env:MONITORED_METRICS -split ","\n    Write-ColorOutput "    ğŸ“ Ä°zlenen metrikler: $($monitoredMetrics -join ', ')" "Gray"\n\n    # Her metrik iÃ§in Ã¶rnek deÄŸerler\n    $metricSamples = @{\n        "route_calculation" = @(145.2, 152.8, 138.5, 149.3, 141.7)\n        "map_rendering" = @(42.8, 38.2, 45.6, 41.3, 39.8)\n        "tile_loading" = @(118.5, 125.8, 112.3, 121.7, 115.4)\n        "api_response" = @(195.3, 182.7, 201.2, 188.5, 197.8)\n    }\n\n    foreach ($metric in $monitoredMetrics) {\n        if ($metricSamples.ContainsKey($metric)) {\n            $values = $metricSamples[$metric]\n            $avg = ($values | Measure-Object -Average).Average\n            $min = ($values | Measure-Object -Minimum).Minimum\n            $max = ($values | Measure-Object -Maximum).Maximum\n\n            Write-ColorOutput "    ğŸ“Š $metric - Avg: ${avg:F1}ms, Min: ${min:F1}ms, Max: ${max:F1}ms" "Gray"\n        }\n    }\n}\n\n# Performans regresyon testi\nfunction Test-PerformanceRegression {\n    Write-ColorOutput "  ğŸ“‰ Performans regresyon testi..." "Gray"\n\n    # SimÃ¼le edilmiÅŸ geÃ§miÅŸ veriler\n    $historicalData = @(\n        @{ Date = "2024-01-01"; Value = 140.0 },\n        @{ Date = "2024-01-02"; Value = 142.5 },\n        @{ Date = "2024-01-03"; Value = 138.8 },\n        @{ Date = "2024-01-04"; Value = 145.2 },\n        @{ Date = "2024-01-05"; Value = 141.7 }\n    )\n\n    $currentValue = 155.3\n    $averageHistorical = ($historicalData | ForEach-Object { $_.Value } | Measure-Object -Average).Average\n    $regression = (($currentValue - $averageHistorical) / $averageHistorical) * 100\n\n    Write-ColorOutput "    ğŸ“ˆ GeÃ§miÅŸ ortalama: ${averageHistorical:F1}ms" "Gray"\n    Write-ColorOutput "    ğŸ“ˆ GÃ¼ncel deÄŸer: ${currentValue:F1}ms" "Gray"\n    Write-ColorOutput "    ğŸ“ˆ Regresyon: ${regression:F2}%" "Gray"\n\n    if ([Math]::Abs($regression) -gt ($PerformanceThreshold * 100)) {\n        Write-ColorOutput "    âš ï¸  Performans regresyonu tespit edildi!" "Yellow"\n    } else {\n        Write-ColorOutput "    âœ… Performans regresyonu yok" "Green"\n    }\n}\n\n# GeÃ§miÅŸ veri yÃ¶netimi testi\nfunction Test-HistoricalDataManagement {\n    Write-ColorOutput "  ğŸ“š GeÃ§miÅŸ veri yÃ¶netimi test ediliyor..." "Gray"\n\n    $maxHistory = [int]$env:MAX_BENCHMARK_HISTORY\n    Write-ColorOutput "    ğŸ“ Maksimum geÃ§miÅŸ kaydÄ±: $maxHistory" "Gray"\n\n    # GeÃ§miÅŸ dosya sayÄ±sÄ± kontrolÃ¼\n    $benchmarkDataPath = Join-Path $env:APPDATA "KesifUygulamasi\BenchmarkData"\n    $benchmarkFiles = Get-ChildItem $benchmarkDataPath -Filter "benchmark_*.json"\n\n    Write-ColorOutput "    ğŸ“„ Mevcut benchmark dosyasÄ± sayÄ±sÄ±: $($benchmarkFiles.Count)" "Gray"\n\n    if ($benchmarkFiles.Count -gt $maxHistory) {\n        Write-ColorOutput "    âš ï¸  GeÃ§miÅŸ dosya sayÄ±sÄ± limiti aÅŸÄ±lmÄ±ÅŸ" "Yellow"\n    } else {\n        Write-ColorOutput "    âœ… GeÃ§miÅŸ dosya sayÄ±sÄ± limit iÃ§inde" "Green"\n    }\n\n    # En eski dosyalarÄ± listele\n    $oldestFiles = $benchmarkFiles | Sort-Object LastWriteTime | Select-Object -First 5\n    if ($oldestFiles) {\n        Write-ColorOutput "    ğŸ“… En eski 5 dosya:" "Gray"\n        foreach ($file in $oldestFiles) {\n            Write-ColorOutput "      - $($file.Name) ($($file.LastWriteTime))" "Gray"\n        }\n    }\n}\n\n# Ana test dÃ¶ngÃ¼sÃ¼\nWrite-ColorOutput "ğŸš€ Dinamik benchmark testleri baÅŸlatÄ±lÄ±yor..." "White"\nWrite-ColorOutput ""\n\n# Testleri Ã§alÄ±ÅŸtÄ±r\nTest-BenchmarkSystem -TestName "Benchmark Veri YapÄ±sÄ±" -TestScript { Test-BenchmarkDataStructure }\nTest-BenchmarkSystem -TestName "Performans Ã–lÃ§Ã¼mÃ¼" -TestScript { Test-PerformanceMeasurement }\nTest-BenchmarkSystem -TestName "Baseline KarÅŸÄ±laÅŸtÄ±rma" -TestScript { Test-BaselineComparison }\nTest-BenchmarkSystem -TestName "Metrik Ä°zleme" -TestScript { Test-MetricMonitoring }\nTest-BenchmarkSystem -TestName "Performans Regresyon" -TestScript { Test-PerformanceRegression }\nTest-BenchmarkSystem -TestName "GeÃ§miÅŸ Veri YÃ¶netimi" -TestScript { Test-HistoricalDataManagement }\n\n# Test Ã¶zeti\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "           ğŸ“Š Test SonuÃ§larÄ±" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\n$successRate = if ($testResults.TotalTests -gt 0) {\n    [math]::Round(($testResults.PassedTests / $testResults.TotalTests) * 100, 1)\n} else { 0 }\n\nWrite-ColorOutput "Toplam Test: $($testResults.TotalTests)" "White"\nWrite-ColorOutput "BaÅŸarÄ±lÄ±: $($testResults.PassedTests)" "Green"\nWrite-ColorOutput "BaÅŸarÄ±sÄ±z: $($testResults.FailedTests)" "Red"\nWrite-ColorOutput "BaÅŸarÄ± OranÄ±: $successRate%" "Cyan"\nWrite-ColorOutput "Toplam SÃ¼re: $($testResults.TestDuration.TotalSeconds) saniye" "White"\n\n# DetaylÄ± sonuÃ§lar\nif ($Verbose) {\n    Write-ColorOutput "" "White"\n    Write-ColorOutput "DetaylÄ± SonuÃ§lar:" "Yellow"\n    foreach ($detail in $testResults.Details) {\n        $status = if ($detail.Passed) { "âœ…" } else { "âŒ" }\n        Write-ColorOutput "  $status $($detail.TestName)" "White"\n        if (!$detail.Passed -and $detail.ErrorMessage) {\n            Write-ColorOutput "    Hata: $($detail.ErrorMessage)" "Red"\n        }\n    }\n}\n\n# JSON export\nif ($ExportJson) {\n    $jsonPath = Join-Path $ProjectPath "benchmark-test-results.json"\n    $exportData = @{\n        metadata = @{\n            timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")\n            script_version = "1.0.0"\n            test_environment = $TestEnvironment\n            max_benchmark_history = $MaxBenchmarkHistory\n            performance_threshold = $PerformanceThreshold\n            monitored_metrics = $MonitoredMetrics\n            total_duration_seconds = $testResults.TestDuration.TotalSeconds\n        }\n        summary = @{\n            total_tests = $testResults.TotalTests\n            passed_tests = $testResults.PassedTests\n            failed_tests = $testResults.FailedTests\n            success_rate = $successRate\n            test_duration = $testResults.TestDuration.ToString()\n        }\n        performance_metrics = @{\n            monitored_count = $MonitoredMetrics.Count\n            baseline_configured = $true\n            regression_detection = $true\n        }\n        details = $testResults.Details\n        recommendations = @(\n            "Baseline deÄŸerlerini production ortamÄ±nda dÃ¼zenli gÃ¼ncelleyin",\n            "Performans threshold'unu uygulama ihtiyaÃ§larÄ±na gÃ¶re ayarlayÄ±n",\n            "Benchmark geÃ§miÅŸini periyodik olarak arÅŸivleyin",\n            "Regresyon alertlerini monitoring sistemine entegre edin"\n        )\n    }\n\n    $exportData | ConvertTo-Json -Depth 10 | Set-Content $jsonPath\n    Write-ColorOutput "ğŸ“„ Test sonuÃ§larÄ± JSON olarak kaydedildi: $jsonPath" "Green"\n}\n\n# Badge tetikleme\nif ($testResults.PassedTests -gt 0) {\n    Show-Badge "Benchmark-Logged"\n}\n\n# Final sonuÃ§\nWrite-ColorOutput "" "White"\nif ($testResults.FailedTests -eq 0) {\n    Write-ColorOutput "ğŸ‰ TÃ¼m dinamik benchmark testleri baÅŸarÄ±lÄ±! CI/CD pipeline devam edebilir." "Green"\n    exit 0\n} else {\n    Write-ColorOutput "ğŸ’¥ BazÄ± benchmark testleri baÅŸarÄ±sÄ±z. LÃ¼tfen performans metriklerini kontrol edin." "Red"\n    exit 1\n}\n\n# Badge gÃ¶sterme fonksiyonu\nfunction Show-Badge {\n    param([string]$BadgeName)\n\n    Write-ColorOutput "ğŸ… Badge kazanÄ±ldÄ±: $BadgeName" "Cyan"\n\n    # Badge dosyasÄ±nÄ± gÃ¼ncelle (varsa)\n    $badgeFile = Join-Path $ProjectPath "badge.json"\n    if (Test-Path $badgeFile) {\n        try {\n            $badgeData = Get-Content $badgeFile -Raw | ConvertFrom-Json\n            if ($badgeData.PSObject.Properties.Name -notcontains $BadgeName) {\n                $badgeData | Add-Member -MemberType NoteProperty -Name $BadgeName -Value $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            } else {\n                $badgeData.$BadgeName = $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            }\n        } catch {\n            Write-ColorOutput "  âš ï¸  Badge dosyasÄ± gÃ¼ncellenemedi" "Yellow"\n        }\n    } else {\n        # Yeni badge dosyasÄ± oluÅŸtur\n        $newBadgeData = @{\n            $BadgeName = $true\n        }\n        $newBadgeData | ConvertTo-Json | Set-Content $badgeFile\n        Write-ColorOutput "  âœ… Yeni badge dosyasÄ± oluÅŸturuldu" "Green"\n    }\n}\n