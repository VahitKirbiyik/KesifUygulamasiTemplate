# Test-Analytics.ps1 - KullanÄ±cÄ± davranÄ±ÅŸ analizi test scripti
# CI/CD pipeline ile entegre edilmiÅŸ analytics ve tracking testi

param(
    [string]$TestEnvironment = "local",
    [string]$Configuration = "Debug",
    [string]$ProjectPath = $PSScriptRoot,
    [switch]$SkipBuild,
    [switch]$Verbose,
    [switch]$ExportJson,
    [string]$AnalyticsPath = "analytics",
    [int]$TestEventCount = 200,
    [int]$TestUserCount = 10
)

# Script ayarlarÄ±
$ErrorActionPreference = "Stop"
$VerbosePreference = if ($Verbose) { "Continue" } else { "SilentlyContinue" }

# Test sonuÃ§larÄ± iÃ§in deÄŸiÅŸkenler
$testResults = @{
    TotalTests = 0
    PassedTests = 0
    FailedTests = 0
    TestDuration = [TimeSpan]::Zero
    Details = @()
    AnalyticsStats = @{
        EventsTracked = 0
        UsersAnalyzed = 0
        EventTypes = @{}
        ErrorRate = 0
        ProcessingTime = [TimeSpan]::Zero
    }
}

# Environment deÄŸiÅŸkenlerini ayarla
$env:TEST_ENVIRONMENT = $TestEnvironment
$env:CI = if ($TestEnvironment -eq "ci") { "true" } else { "false" }
$env:ANALYTICS_PATH = $AnalyticsPath
$env:ENABLE_ANALYTICS = "true"
$env:MAX_ANALYTICS_FILE_SIZE_MB = "10"
$env:ANALYTICS_RETENTION_DAYS = "30"
$env:ENABLE_REALTIME_ANALYTICS = "true"

# Renkli output iÃ§in
function Write-ColorOutput {
    param(
        [string]$Message,
        [string]$Color = "White"
    )
    Write-Host $Message -ForegroundColor $Color
}

# BaÅŸlÄ±k
Write-ColorOutput "=========================================" "Cyan"
Write-ColorOutput "      ğŸ“ˆ Analytics Test Sistemi" "Cyan"
Write-ColorOutput "=========================================" "Cyan"
Write-ColorOutput ""

# Proje yolunu kontrol et
if (!(Test-Path $ProjectPath)) {
    Write-ColorOutput "Hata: Proje yolu bulunamadÄ±: $ProjectPath" "Red"
    exit 1
}

# Test fonksiyonlarÄ±
function Test-Analytics {
    param(
        [string]$TestName,
        [scriptblock]$TestScript
    )

    $startTime = Get-Date
    $testPassed = $false
    $errorMessage = ""

    Write-ColorOutput "ğŸ§ª $TestName testi baÅŸlatÄ±lÄ±yor..." "White"

    try {
        & $TestScript
        $testPassed = $true
        Write-ColorOutput "  âœ… $TestName testi baÅŸarÄ±lÄ±" "Green"
    } catch {
        $errorMessage = $_.Exception.Message
        Write-ColorOutput "  âŒ $TestName testi baÅŸarÄ±sÄ±z: $errorMessage" "Red"
    } finally {
        $endTime = Get-Date
        $duration = $endTime - $startTime

        $testResults.TotalTests++
        if ($testPassed) {
            $testResults.PassedTests++
        } else {
            $testResults.FailedTests++
        }
        $testResults.TestDuration += $duration

        $testResults.Details += @{
            TestName = $TestName
            Passed = $testPassed
            Duration = $duration
            ErrorMessage = $errorMessage
        }
    }
}

# Analytics klasÃ¶rÃ¼ oluÅŸturma testi
function Test-AnalyticsDirectorySetup {
    Write-ColorOutput "  ğŸ“ Analytics klasÃ¶rÃ¼ kurulumu kontrol ediliyor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath

    if (!(Test-Path $fullAnalyticsPath)) {
        Write-ColorOutput "    ğŸ“‚ Analytics klasÃ¶rÃ¼ oluÅŸturuluyor: $fullAnalyticsPath" "Gray"
        New-Item -ItemType Directory -Path $fullAnalyticsPath -Force | Out-Null
    } else {
        Write-ColorOutput "    âœ… Analytics klasÃ¶rÃ¼ mevcut: $fullAnalyticsPath" "Green"
    }

    # Test analytics dosyasÄ± oluÅŸtur
    $testFile = Join-Path $fullAnalyticsPath "test-analytics.json"
    $testData = @{
        test = "Analytics test"
        timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
    }
    $testData | ConvertTo-Json | Set-Content $testFile

    if (Test-Path $testFile) {
        Write-ColorOutput "    âœ… Test analytics dosyasÄ± oluÅŸturuldu" "Green"
        Remove-Item $testFile -Force
    } else {
        Write-ColorOutput "    âŒ Test analytics dosyasÄ± oluÅŸturulamadÄ±" "Red"
        throw "Analytics directory setup failed"
    }
}

# Olay tracking testi
function Test-EventTracking {
    Write-ColorOutput "  ğŸ“Š Olay tracking testi baÅŸlatÄ±lÄ±yor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath
    $testFile = Join-Path $fullAnalyticsPath "test-events.json"

    # Test olaylarÄ±
    $eventTypes = @("page_view", "user_interaction", "route_usage", "error", "performance")
    $trackedEvents = 0
    $eventCounts = @{}

    for ($i = 1; $i -le $TestEventCount; $i++) {
        $userId = "user_$($i % $TestUserCount + 1)"
        $eventType = $eventTypes[$i % $eventTypes.Count]

        $analyticsEvent = @{
            Id = [Guid]::NewGuid().ToString()
            EventName = $eventType
            UserId = $userId
            Timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
            Environment = $TestEnvironment
            Properties = @{
                test_run = $true
                event_number = $i
            }
            SessionId = "$userId`_session_$(Get-Date -Format 'yyyyMMddHHmmss')"
            Source = "KesifUygulamasiTemplate"
        }

        # JSON dosyasÄ±na ekle
        $analyticsEvent | ConvertTo-Json -Compress | Out-File $testFile -Append -Encoding UTF8

        $trackedEvents++
        if ($eventCounts.ContainsKey($eventType)) {
            $eventCounts[$eventType]++
        } else {
            $eventCounts[$eventType] = 1
        }
    }

    Write-ColorOutput "    ğŸ“ $trackedEvents olay track edildi" "Gray"
    Write-ColorOutput "    ğŸ‘¥ $TestUserCount benzersiz kullanÄ±cÄ±" "Gray"

    foreach ($eventType in $eventTypes) {
        if ($eventCounts.ContainsKey($eventType)) {
            Write-ColorOutput "    ğŸ“Š $eventType : $($eventCounts[$eventType]) olay" "Gray"
        }
    }

    # Test sonuÃ§larÄ±nÄ± gÃ¼ncelle
    $testResults.AnalyticsStats.EventsTracked = $trackedEvents
    $testResults.AnalyticsStats.UsersAnalyzed = $TestUserCount
    $testResults.AnalyticsStats.EventTypes = $eventCounts

    if ($trackedEvents -eq $TestEventCount) {
        Write-ColorOutput "    âœ… Olay tracking baÅŸarÄ±lÄ±" "Green"
    } else {
        Write-ColorOutput "    âŒ Olay tracking sayÄ±sÄ± uyumsuz" "Red"
        throw "Event tracking count mismatch"
    }
}

# KullanÄ±cÄ± davranÄ±ÅŸ analizi testi
function Test-UserBehaviorAnalysis {
    Write-ColorOutput "  ğŸ§  KullanÄ±cÄ± davranÄ±ÅŸ analizi testi baÅŸlatÄ±lÄ±yor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath
    $analysisFile = Join-Path $fullAnalyticsPath "behavior-analysis.json"

    # Test iÃ§in kullanÄ±cÄ± davranÄ±ÅŸ verileri oluÅŸtur
    $userBehaviors = @()
    $testUsers = 1..$TestUserCount

    foreach ($user in $testUsers) {
        $userId = "user_$user"
        $userEvents = @()

        # Her kullanÄ±cÄ± iÃ§in rastgele olaylar oluÅŸtur
        $userEventCount = Get-Random -Minimum 5 -Maximum 20
        for ($i = 1; $i -le $userEventCount; $i++) {
            $eventType = @("page_view", "user_interaction", "route_usage", "error", "performance") | Get-Random
            $userEvents += @{
                EventName = $eventType
                Timestamp = (Get-Date).AddMinutes(-(Get-Random -Minimum 1 -Maximum 1440)).ToString("yyyy-MM-ddTHH:mm:ssZ")
                Properties = @{
                    page_name = if ($eventType -eq "page_view") { @("Home", "Map", "Routes", "Settings") | Get-Random } else { "" }
                    interaction_type = if ($eventType -eq "user_interaction") { @("click", "scroll", "zoom") | Get-Random } else { "" }
                }
            }
        }

        $userBehaviors += @{
            UserId = $userId
            TotalEvents = $userEvents.Count
            SessionCount = [math]::Ceiling($userEvents.Count / 5) # Basit session hesabÄ±
            InteractionPatterns = $userEvents | Group-Object -Property EventName | ForEach-Object { @{ $_.Name = $_.Count } }
            PageFlow = $userEvents | Where-Object { $_.EventName -eq "page_view" } | ForEach-Object { $_.Properties.page_name }
        }
    }

    # Analiz sonuÃ§larÄ±nÄ± JSON'a kaydet
    $analysisResult = @{
        AnalysisTimestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
        TotalUsers = $testUsers.Count
        UserBehaviors = $userBehaviors
        Summary = @{
            AverageEventsPerUser = ($userBehaviors | Measure-Object -Property TotalEvents -Average).Average
            MostCommonEvent = $userBehaviors.InteractionPatterns | Group-Object -Property Keys | Sort-Object -Property Count -Descending | Select-Object -First 1
        }
    }

    $analysisResult | ConvertTo-Json -Depth 10 | Set-Content $analysisFile

    Write-ColorOutput "    ğŸ‘¥ $($testUsers.Count) kullanÄ±cÄ± davranÄ±ÅŸ analizi tamamlandÄ±" "Gray"
    Write-ColorOutput "    ğŸ“Š Ortalama olay sayÄ±sÄ±: $([math]::Round($analysisResult.Summary.AverageEventsPerUser, 1))" "Gray"

    if ($userBehaviors.Count -eq $TestUserCount) {
        Write-ColorOutput "    âœ… KullanÄ±cÄ± davranÄ±ÅŸ analizi baÅŸarÄ±lÄ±" "Green"
    } else {
        Write-ColorOutput "    âŒ KullanÄ±cÄ± sayÄ±sÄ± uyumsuz" "Red"
        throw "User behavior analysis count mismatch"
    }
}

# Performans tracking testi
function Test-PerformanceTracking {
    Write-ColorOutput "  âš¡ Performans tracking testi baÅŸlatÄ±lÄ±yor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath
    $performanceFile = Join-Path $fullAnalyticsPath "performance-metrics.json"

    # Test performans metrikleri
    $performanceMetrics = @()
    $metricTypes = @("page_load_time", "api_response_time", "route_calculation_time", "tile_load_time")

    for ($i = 1; $i -le 50; $i++) {
        $metricType = $metricTypes | Get-Random
        $value = Get-Random -Minimum 100 -Maximum 10000 # ms cinsinden
        $userId = "user_$($i % $TestUserCount + 1)"

        $performanceMetrics += @{
            Id = [Guid]::NewGuid().ToString()
            EventName = "performance"
            UserId = $userId
            Timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
            Environment = $TestEnvironment
            Properties = @{
                metric_name = $metricType
                value = $value
                context = "test_run"
            }
        }
    }

    # Performans metriklerini JSON'a kaydet
    $performanceMetrics | ConvertTo-Json -Compress | Set-Content $performanceFile

    # Performans analizi
    $avgPageLoad = ($performanceMetrics | Where-Object { $_.Properties.metric_name -eq "page_load_time" } | Measure-Object -Property { $_.Properties.value } -Average).Average
    $avgApiResponse = ($performanceMetrics | Where-Object { $_.Properties.metric_name -eq "api_response_time" } | Measure-Object -Property { $_.Properties.value } -Average).Average

    Write-ColorOutput "    ğŸ“ˆ Sayfa yÃ¼kleme sÃ¼resi ortalamasÄ±: $([math]::Round($avgPageLoad, 0)) ms" "Gray"
    Write-ColorOutput "    ğŸ“ˆ API yanÄ±t sÃ¼resi ortalamasÄ±: $([math]::Round($avgApiResponse, 0)) ms" "Gray"

    # Performans eÅŸikleri kontrolÃ¼
    $slowPages = $performanceMetrics | Where-Object { $_.Properties.metric_name -eq "page_load_time" -and $_.Properties.value -gt 3000 }
    if ($slowPages.Count -gt 0) {
        Write-ColorOutput "    âš ï¸  $($slowPages.Count) yavaÅŸ sayfa yÃ¼klemesi tespit edildi" "Yellow"
    } else {
        Write-ColorOutput "    âœ… TÃ¼m sayfa yÃ¼klemeleri kabul edilebilir" "Green"
    }

    if ($performanceMetrics.Count -gt 0) {
        Write-ColorOutput "    âœ… Performans tracking baÅŸarÄ±lÄ±" "Green"
    } else {
        Write-ColorOutput "    âŒ Performans metrikleri oluÅŸturulamadÄ±" "Red"
        throw "Performance tracking failed"
    }
}

# Hata tracking testi
function Test-ErrorTracking {
    Write-ColorOutput "  ğŸš¨ Hata tracking testi baÅŸlatÄ±lÄ±yor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath
    $errorFile = Join-Path $fullAnalyticsPath "error-tracking.json"

    # Test hatalarÄ±
    $errorTypes = @("network_error", "api_error", "ui_error", "data_error", "auth_error")
    $errorMessages = @(
        "Network connection failed",
        "API endpoint not found",
        "UI component render error",
        "Data parsing failed",
        "Authentication token expired"
    )

    $trackedErrors = @()
    $errorCount = 20

    for ($i = 1; $i -le $errorCount; $i++) {
        $errorType = $errorTypes | Get-Random
        $errorMessage = $errorMessages | Get-Random
        $userId = "user_$($i % $TestUserCount + 1)"

        $errorEvent = @{
            Id = [Guid]::NewGuid().ToString()
            EventName = "error"
            UserId = $userId
            Timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
            Environment = $TestEnvironment
            Properties = @{
                error_type = $errorType
                error_message = $errorMessage
                stack_trace = "at TestMethod() in TestFile.cs:line 42"
            }
        }

        $trackedErrors += $errorEvent
    }

    # Hata olaylarÄ±nÄ± JSON'a kaydet
    $trackedErrors | ConvertTo-Json -Compress | Set-Content $errorFile

    # Hata analizi
    $errorStats = $trackedErrors | Group-Object -Property { $_.Properties.error_type } | ForEach-Object {
        @{ $_.Name = $_.Count }
    }

    Write-ColorOutput "    ğŸš¨ $errorCount hata olayÄ± track edildi" "Gray"
    Write-ColorOutput "    ğŸ“Š Hata daÄŸÄ±lÄ±mÄ±:" "Gray"
    foreach ($errorStat in $errorStats) {
        foreach ($errorType in $errorStat.Keys) {
            Write-ColorOutput "      - $errorType : $($errorStat[$errorType])" "Gray"
        }
    }

    # Hata oranÄ±nÄ± hesapla
    $errorRate = $errorCount / $TestEventCount
    $testResults.AnalyticsStats.ErrorRate = $errorRate

    Write-ColorOutput "    ğŸ“ˆ Hata oranÄ±: $([math]::Round($errorRate * 100, 2))%" "Gray"

    if ($errorRate -lt 0.1) { # %10'dan az hata kabul edilebilir
        Write-ColorOutput "    âœ… Hata oranÄ± kabul edilebilir" "Green"
    } else {
        Write-ColorOutput "    âš ï¸  Hata oranÄ± yÃ¼ksek" "Yellow"
    }
}

# Analytics temizleme testi
function Test-AnalyticsCleanup {
    Write-ColorOutput "  ğŸ§¹ Analytics temizleme testi baÅŸlatÄ±lÄ±yor..." "Gray"

    $fullAnalyticsPath = Join-Path $ProjectPath $AnalyticsPath

    # Eski test dosyalarÄ± oluÅŸtur
    $oldFiles = @()
    $oldDate = (Get-Date).AddDays(-40) # 40 gÃ¼n Ã¶nce

    for ($i = 1; $i -le 3; $i++) {
        $oldFileName = "old-analytics-$i.json"
        $oldFilePath = Join-Path $fullAnalyticsPath $oldFileName
        @{ test = "old analytics data $i"; timestamp = $oldDate.ToString("yyyy-MM-ddTHH:mm:ssZ") } | ConvertTo-Json | Set-Content $oldFilePath
        (Get-Item $oldFilePath).CreationTime = $oldDate
        $oldFiles += $oldFilePath
    }

    # Yeni test dosyasÄ± oluÅŸtur
    $newFileName = "new-analytics.json"
    $newFilePath = Join-Path $fullAnalyticsPath $newFileName
    @{ test = "new analytics data"; timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ") } | ConvertTo-Json | Set-Content $newFilePath

    Write-ColorOutput "    ğŸ“… Eski dosyalar oluÅŸturuldu: $($oldFiles.Count)" "Gray"
    Write-ColorOutput "    ğŸ“… Yeni dosya oluÅŸturuldu: $newFileName" "Gray"

    # Eski dosyalarÄ± temizle (30 gÃ¼nden eski)
    $retentionDays = 30
    $cutoffDate = (Get-Date).AddDays(-$retentionDays)

    $filesToDelete = Get-ChildItem $fullAnalyticsPath -Filter "*.json" |
        Where-Object { $_.CreationTime -lt $cutoffDate }

    $deletedCount = 0
    foreach ($file in $filesToDelete) {
        Remove-Item $file.FullName -Force
        $deletedCount++
        Write-ColorOutput "    âœ… Eski dosya silindi: $($file.Name)" "Green"
    }

    # Yeni dosyanÄ±n kaldÄ±ÄŸÄ±nÄ± kontrol et
    if (Test-Path $newFilePath) {
        Write-ColorOutput "    âœ… Yeni dosya korundu" "Green"
    } else {
        Write-ColorOutput "    âŒ Yeni dosya yanlÄ±ÅŸlÄ±kla silindi" "Red"
    }

    Write-ColorOutput "    ğŸ“Š Temizleme Ä°statistikleri:" "Gray"
    Write-ColorOutput "      - Silinen Dosya: $deletedCount" "Gray"
    Write-ColorOutput "      - Korunan Dosya: 1" "Gray"
}

# Ana test dÃ¶ngÃ¼sÃ¼
Write-ColorOutput "ğŸš€ Analytics testleri baÅŸlatÄ±lÄ±yor..." "White"
Write-ColorOutput ""

# Testleri Ã§alÄ±ÅŸtÄ±r
Test-Analytics -TestName "Analytics KlasÃ¶rÃ¼ Kurulumu" -TestScript { Test-AnalyticsDirectorySetup }
Test-Analytics -TestName "Olay Tracking" -TestScript { Test-EventTracking }
Test-Analytics -TestName "KullanÄ±cÄ± DavranÄ±ÅŸ Analizi" -TestScript { Test-UserBehaviorAnalysis }
Test-Analytics -TestName "Performans Tracking" -TestScript { Test-PerformanceTracking }
Test-Analytics -TestName "Hata Tracking" -TestScript { Test-ErrorTracking }
Test-Analytics -TestName "Analytics Temizleme" -TestScript { Test-AnalyticsCleanup }

# Test Ã¶zeti
Write-ColorOutput "" "White"
Write-ColorOutput "=========================================" "Cyan"
Write-ColorOutput "           ğŸ“Š Test SonuÃ§larÄ±" "Cyan"
Write-ColorOutput "=========================================" "Cyan"

$successRate = if ($testResults.TotalTests -gt 0) {
    [math]::Round(($testResults.PassedTests / $testResults.TotalTests) * 100, 1)
} else { 0 }

Write-ColorOutput "Toplam Test: $($testResults.TotalTests)" "White"
Write-ColorOutput "BaÅŸarÄ±lÄ±: $($testResults.PassedTests)" "Green"
Write-ColorOutput "BaÅŸarÄ±sÄ±z: $($testResults.FailedTests)" "Red"
Write-ColorOutput "BaÅŸarÄ± OranÄ±: $successRate%" "Cyan"
Write-ColorOutput "Toplam SÃ¼re: $($testResults.TestDuration.TotalSeconds) saniye" "White"

# Analytics istatistikleri
Write-ColorOutput "" "White"
Write-ColorOutput "=========================================" "Cyan"
Write-ColorOutput "        ğŸ“ˆ Analytics Ä°statistikleri" "Cyan"
Write-ColorOutput "=========================================" "Cyan"

Write-ColorOutput "Track Edilen Olay: $($testResults.AnalyticsStats.EventsTracked)" "White"
Write-ColorOutput "Analiz Edilen KullanÄ±cÄ±: $($testResults.AnalyticsStats.UsersAnalyzed)" "White"
Write-ColorOutput "Hata OranÄ±: $([math]::Round($testResults.AnalyticsStats.ErrorRate * 100, 2))%" "White"

Write-ColorOutput "Olay TÃ¼rleri DaÄŸÄ±lÄ±mÄ±:" "Gray"
foreach ($eventType in $testResults.AnalyticsStats.EventTypes.Keys) {
    Write-ColorOutput "  - $eventType : $($testResults.AnalyticsStats.EventTypes[$eventType])" "Gray"
}

# DetaylÄ± sonuÃ§lar
if ($Verbose) {
    Write-ColorOutput "" "White"
    Write-ColorOutput "DetaylÄ± SonuÃ§lar:" "Yellow"
    foreach ($detail in $testResults.Details) {
        $status = if ($detail.Passed) { "âœ…" } else { "âŒ" }
        Write-ColorOutput "  $status $($detail.TestName)" "White"
        if (!$detail.Passed -and $detail.ErrorMessage) {
            Write-ColorOutput "    Hata: $($detail.ErrorMessage)" "Red"
        }
    }
}

# JSON export
if ($ExportJson) {
    $jsonPath = Join-Path $ProjectPath "analytics-test-results.json"
    $exportData = @{
        metadata = @{
            timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")
            script_version = "1.0.0"
            test_environment = $TestEnvironment
            analytics_path = $AnalyticsPath
            test_event_count = $TestEventCount
            test_user_count = $TestUserCount
            total_duration_seconds = $testResults.TestDuration.TotalSeconds
        }
        summary = @{
            total_tests = $testResults.TotalTests
            passed_tests = $testResults.PassedTests
            failed_tests = $testResults.FailedTests
            success_rate = $successRate
        }
        analytics_stats = $testResults.AnalyticsStats
        details = $testResults.Details
        recommendations = @(
            "Analytics retention sÃ¼resini kullanÄ±m paternlerine gÃ¶re optimize edin",
            "Real-time processing iÃ§in event filtering kurallarÄ± tanÄ±mlayÄ±n",
            "User behavior analysis iÃ§in segmentation kurallarÄ± ekleyin",
            "Performance metrics iÃ§in alerting thresholds belirleyin",
            "Error tracking iÃ§in automated incident response kurun"
        )
    }

    $exportData | ConvertTo-Json -Depth 10 | Set-Content $jsonPath
    Write-ColorOutput "ğŸ“„ Test sonuÃ§larÄ± JSON olarak kaydedildi: $jsonPath" "Green"
}

# Badge tetikleme
if ($testResults.PassedTests -gt 0) {
    Show-Badge "Behavior-Analyzed"
}

# Final sonuÃ§
Write-ColorOutput "" "White"
if ($testResults.FailedTests -eq 0) {
    Write-ColorOutput "ğŸ‰ Analytics testleri baÅŸarÄ±lÄ±! KullanÄ±cÄ± davranÄ±ÅŸ analizi sistemi hazÄ±r." "Green"
    exit 0
} else {
    Write-ColorOutput "ğŸ’¥ BazÄ± analytics testleri baÅŸarÄ±sÄ±z oldu." "Red"
    exit 1
}

# Badge gÃ¶sterme fonksiyonu
function Show-Badge {
    param([string]$BadgeName)

    Write-ColorOutput "ğŸ… Badge kazanÄ±ldÄ±: $BadgeName" "Cyan"

    # Badge dosyasÄ±nÄ± gÃ¼ncelle (varsa)
    $badgeFile = Join-Path $ProjectPath "badge.json"
    if (Test-Path $badgeFile) {
        try {
            $badgeData = Get-Content $badgeFile -Raw | ConvertFrom-Json
            if ($badgeData.PSObject.Properties.Name -notcontains $BadgeName) {
                $badgeData | Add-Member -MemberType NoteProperty -Name $BadgeName -Value $true
                $badgeData | ConvertTo-Json | Set-Content $badgeFile
                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"
            } else {
                $badgeData.$BadgeName = $true
                $badgeData | ConvertTo-Json | Set-Content $badgeFile
                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"
            }
        } catch {
            Write-ColorOutput "  âš ï¸  Badge dosyasÄ± gÃ¼ncellenemedi" "Yellow"
        }
    } else {
        # Yeni badge dosyasÄ± oluÅŸtur
        $newBadgeData = @{
            $BadgeName = $true
        }
        $newBadgeData | ConvertTo-Json | Set-Content $badgeFile
        Write-ColorOutput "  âœ… Yeni badge dosyasÄ± oluÅŸturuldu" "Green"
    }
}
