# Test-LegalFiles.ps1 - CI/CD pipeline ile entegre legal dosya doÄŸrulama testi\n# Bu script privacy policy, terms of service, robots.txt ve sitemap.xml dosyalarÄ±nÄ± doÄŸrular\n\nparam(\n    [string]$TestEnvironment = "local",\n    [string]$Configuration = "Debug",\n    [string]$ProjectPath = $PSScriptRoot,\n    [switch]$SkipBuild,\n    [switch]$Verbose,\n    [switch]$ExportJson,\n    [string]$Domain = "https://kesifapp.com"\n)\n\n# Script ayarlarÄ±\n$ErrorActionPreference = "Stop"\n$VerbosePreference = if ($Verbose) { "Continue" } else { "SilentlyContinue" }\n\n# Test sonuÃ§larÄ± iÃ§in deÄŸiÅŸkenler\n$testResults = @{\n    TotalTests = 0\n    PassedTests = 0\n    FailedTests = 0\n    TestDuration = [TimeSpan]::Zero\n    Details = @()\n}\n\n# Renkli output iÃ§in\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = "White"\n    )\n    Write-Host $Message -ForegroundColor $Color\n}\n\n# BaÅŸlÄ±k\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "    ğŸ§¾ Legal Dosya DoÄŸrulama Testi" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput ""\n\n# Environment deÄŸiÅŸkenlerini ayarla\n$env:TEST_ENVIRONMENT = $TestEnvironment\n$env:CI = if ($TestEnvironment -eq "ci") { "true" } else { "false" }\n$env:DOMAIN = $Domain\n\nWrite-ColorOutput "Test Environment: $TestEnvironment" "Yellow"\nWrite-ColorOutput "Domain: $Domain" "Yellow"\nWrite-ColorOutput "Project Path: $ProjectPath" "Yellow"\nWrite-ColorOutput ""\n\n# Proje yolunu kontrol et\nif (!(Test-Path $ProjectPath)) {\n    Write-ColorOutput "Hata: Proje yolu bulunamadÄ±: $ProjectPath" "Red"\n    exit 1\n}\n\n# Legal dosyalar listesi\n$legalFiles = @(\n    @{ Path = ".\legal\privacy-policy.md"; Name = "Privacy Policy"; Required = $true },\n    @{ Path = ".\legal\terms-of-service.md"; Name = "Terms of Service"; Required = $true },\n    @{ Path = ".\robots.txt"; Name = "Robots.txt"; Required = $true },\n    @{ Path = ".\sitemap.xml"; Name = "Sitemap.xml"; Required = $true },\n    @{ Path = ".\legal\cookie-policy.md"; Name = "Cookie Policy"; Required = $false },\n    @{ Path = ".\legal\data-processing-agreement.md"; Name = "Data Processing Agreement"; Required = $false },\n    @{ Path = ".\legal\gdpr-compliance.md"; Name = "GDPR Compliance"; Required = $false }\n)\n\n# SEO dosyalar listesi\n$seoFiles = @(\n    @{ Path = ".\seo\description.txt"; Name = "SEO Description"; Required = $true },\n    @{ Path = ".\seo\keywords.txt"; Name = "SEO Keywords"; Required = $true },\n    @{ Path = ".\seo\meta-tags.html"; Name = "Meta Tags"; Required = $false },\n    @{ Path = ".\seo\structured-data.json"; Name = "Structured Data"; Required = $false }\n)\n\n# Test fonksiyonlarÄ±\nfunction Test-FileExists {\n    param(\n        [string]$FilePath,\n        [string]$FileName,\n        [bool]$Required = $true\n    )\n\n    $startTime = Get-Date\n    $testPassed = $false\n    $errorMessage = ""\n\n    Write-ColorOutput "ğŸ§ª $FileName dosyasÄ± kontrol ediliyor..." "White"\n\n    try {\n        $fullPath = Join-Path $ProjectPath $FilePath\n\n        if (Test-Path $fullPath) {\n            Write-ColorOutput "  âœ… Dosya bulundu: $FilePath" "Green"\n\n            # Dosya iÃ§eriÄŸi kontrolÃ¼\n            $fileInfo = Get-Item $fullPath\n            $fileSize = $fileInfo.Length\n\n            if ($fileSize -eq 0) {\n                $errorMessage = "Dosya boÅŸ"\n                Write-ColorOutput "  âš ï¸  Dosya boÅŸ: $fileSize bytes" "Yellow"\n                $testPassed = !$Required  # Required deÄŸilse boÅŸ dosya kabul edilebilir\n            } else {\n                Write-ColorOutput "  ğŸ“„ Dosya boyutu: $fileSize bytes" "Gray"\n                $testPassed = $true\n\n                # Ä°Ã§erik temel kontrolÃ¼\n                Test-FileContent -FilePath $fullPath -FileName $FileName\n            }\n        } else {\n            $errorMessage = "Dosya bulunamadÄ±"\n            if ($Required) {\n                Write-ColorOutput "  âŒ Gerekli dosya bulunamadÄ±: $FilePath" "Red"\n            } else {\n                Write-ColorOutput "  âš ï¸  Ä°steÄŸe baÄŸlÄ± dosya bulunamadÄ±: $FilePath" "Yellow"\n                $testPassed = $true  # Ä°steÄŸe baÄŸlÄ± dosya iÃ§in test baÅŸarÄ±lÄ±\n            }\n        }\n\n    } catch {\n        $errorMessage = $_.Exception.Message\n        Write-ColorOutput "  ğŸ’¥ Dosya kontrol hatasÄ±: $errorMessage" "Red"\n    } finally {\n        $endTime = Get-Date\n        $duration = $endTime - $startTime\n\n        $testResults.TotalTests++\n        if ($testPassed) {\n            $testResults.PassedTests++\n        } else {\n            $testResults.FailedTests++\n        }\n        $testResults.TestDuration += $duration\n\n        $testResults.Details += @{\n            TestName = "$FileName Dosya KontrolÃ¼"\n            FilePath = $FilePath\n            Passed = $testPassed\n            Required = $Required\n            Duration = $duration\n            ErrorMessage = $errorMessage\n        }\n    }\n}\n\nfunction Test-FileContent {\n    param(\n        [string]$FilePath,\n        [string]$FileName\n    )\n\n    try {\n        $content = Get-Content $FilePath -Raw\n\n        # Temel iÃ§erik kontrolleri\n        switch -Wildcard ($FileName) {\n            "*Privacy*" {\n                # Privacy policy iÃ§in gerekli kelimeler\n                $requiredTerms = @("privacy", "data", "personal information", "cookies")\n                $missingTerms = $requiredTerms | Where-Object { $content -notmatch $_ }\n                if ($missingTerms) {\n                    Write-ColorOutput "  âš ï¸  Privacy policy'de eksik terimler: $($missingTerms -join ', ')" "Yellow"\n                }\n            }\n            "*Terms*" {\n                # Terms of service iÃ§in gerekli kelimeler\n                $requiredTerms = @("terms", "service", "agreement", "liability")\n                $missingTerms = $requiredTerms | Where-Object { $content -notmatch $_ }\n                if ($missingTerms) {\n                    Write-ColorOutput "  âš ï¸  Terms'de eksik terimler: $($missingTerms -join ', ')" "Yellow"\n                }\n            }\n            "*Robots*" {\n                # Robots.txt iÃ§in temel yapÄ± kontrolÃ¼\n                if ($content -notmatch "User-agent") {\n                    Write-ColorOutput "  âš ï¸  Robots.txt'de User-agent bulunamadÄ±" "Yellow"\n                }\n            }\n            "*Sitemap*" {\n                # Sitemap.xml iÃ§in domain kontrolÃ¼\n                if ($content -notmatch $Domain) {\n                    Write-ColorOutput "  âš ï¸  Sitemap.xml'de domain bulunamadÄ±: $Domain" "Yellow"\n                }\n            }\n        }\n\n        Write-ColorOutput "  âœ… Dosya iÃ§eriÄŸi kontrol edildi" "Green"\n\n    } catch {\n        Write-ColorOutput "  âš ï¸  Dosya iÃ§eriÄŸi kontrol edilemedi: $($_.Exception.Message)" "Yellow"\n    }\n}\n\nfunction Test-WebAccessibility {\n    param([string]$Url)\n\n    Write-ColorOutput "ğŸŒ Web eriÅŸilebilirliÄŸi kontrol ediliyor: $Url" "White"\n\n    try {\n        $response = Invoke-WebRequest -Uri $Url -Method Head -TimeoutSec 10\n        if ($response.StatusCode -eq 200) {\n            Write-ColorOutput "  âœ… URL eriÅŸilebilir: $($response.StatusCode)" "Green"\n            return $true\n        } else {\n            Write-ColorOutput "  âŒ URL eriÅŸilemez: $($response.StatusCode)" "Red"\n            return $false\n        }\n    } catch {\n        Write-ColorOutput "  âš ï¸  URL kontrol edilemedi: $($_.Exception.Message)" "Yellow"\n        return $false\n    }\n}\n\nfunction Show-Badge {\n    param([string]$BadgeName)\n\n    Write-ColorOutput "ğŸ… Badge kazanÄ±ldÄ±: $BadgeName" "Cyan"\n\n    # Badge dosyasÄ±nÄ± gÃ¼ncelle (varsa)\n    $badgeFile = Join-Path $ProjectPath "badge.json"\n    if (Test-Path $badgeFile) {\n        try {\n            $badgeData = Get-Content $badgeFile -Raw | ConvertFrom-Json\n            if ($badgeData.PSObject.Properties.Name -contains $BadgeName) {\n                $badgeData.$BadgeName = $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            }\n        } catch {\n            Write-ColorOutput "  âš ï¸  Badge dosyasÄ± gÃ¼ncellenemedi" "Yellow"\n        }\n    }\n}\n\n# Ana test dÃ¶ngÃ¼sÃ¼\nWrite-ColorOutput "ğŸš€ Legal ve SEO dosya testleri baÅŸlatÄ±lÄ±yor..." "White"\nWrite-ColorOutput ""\n\n# Legal dosyalar testi\nWrite-ColorOutput "ğŸ“‹ Legal Dosyalar:" "Cyan"\nforeach ($file in $legalFiles) {\n    Test-FileExists -FilePath $file.Path -FileName $file.Name -Required $file.Required\n}\n\nWrite-ColorOutput ""\n\n# SEO dosyalar testi\nWrite-ColorOutput "ğŸ” SEO Dosyalar:" "Cyan"\nforeach ($file in $seoFiles) {\n    Test-FileExists -FilePath $file.Path -FileName $file.Name -Required $file.Required\n}\n\nWrite-ColorOutput ""\n\n# Web eriÅŸilebilirlik testi (production ortamÄ±nda)\nif ($TestEnvironment -ne "local") {\n    Write-ColorOutput "ğŸŒ Web EriÅŸilebilirlik Testleri:" "Cyan"\n\n    $webUrls = @(\n        "$Domain/legal/privacy-policy.html",\n        "$Domain/legal/terms-of-service.html",\n        "$Domain/robots.txt",\n        "$Domain/sitemap.xml"\n    )\n\n    foreach ($url in $webUrls) {\n        Test-WebAccessibility -Url $url\n    }\n}\n\n# Test Ã¶zeti\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "           ğŸ“Š Test SonuÃ§larÄ±" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\n$successRate = if ($testResults.TotalTests -gt 0) {\n    [math]::Round(($testResults.PassedTests / $testResults.TotalTests) * 100, 1)\n} else { 0 }\n\nWrite-ColorOutput "Toplam Test: $($testResults.TotalTests)" "White"\nWrite-ColorOutput "BaÅŸarÄ±lÄ±: $($testResults.PassedTests)" "Green"\nWrite-ColorOutput "BaÅŸarÄ±sÄ±z: $($testResults.FailedTests)" "Red"\nWrite-ColorOutput "BaÅŸarÄ± OranÄ±: $successRate%" "Cyan"\nWrite-ColorOutput "Toplam SÃ¼re: $($testResults.TestDuration.TotalSeconds) saniye" "White"\n\n# DetaylÄ± sonuÃ§lar\nif ($Verbose) {\n    Write-ColorOutput "" "White"\n    Write-ColorOutput "DetaylÄ± SonuÃ§lar:" "Yellow"\n    foreach ($detail in $testResults.Details) {\n        $status = if ($detail.Passed) { "âœ…" } else { "âŒ" }\n        $required = if ($detail.Required) { " (Gerekli)" } else { " (Ä°steÄŸe baÄŸlÄ±)" }\n        Write-ColorOutput "  $status $($detail.TestName)$required" "White"\n        if (!$detail.Passed -and $detail.ErrorMessage) {\n            Write-ColorOutput "    Hata: $($detail.ErrorMessage)" "Red"\n        }\n    }\n}\n\n# JSON export\nif ($ExportJson) {\n    $jsonPath = Join-Path $ProjectPath "legal-seo-test-results.json"\n    $exportData = @{\n        metadata = @{\n            timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")\n            script_version = "1.0.0"\n            test_environment = $TestEnvironment\n            domain = $Domain\n            total_duration_seconds = $testResults.TestDuration.TotalSeconds\n        }\n        summary = @{\n            total_tests = $testResults.TotalTests\n            passed_tests = $testResults.PassedTests\n            failed_tests = $testResults.FailedTests\n            success_rate = $successRate\n            test_duration = $testResults.TestDuration.ToString()\n        }\n        legal_files = @{\n            required = $legalFiles | Where-Object { $_.Required } | ForEach-Object { $_.Name }\n            optional = $legalFiles | Where-Object { !$_.Required } | ForEach-Object { $_.Name }\n        }\n        seo_files = @{\n            required = $seoFiles | Where-Object { $_.Required } | ForEach-Object { $_.Name }\n            optional = $seoFiles | Where-Object { !$_.Required } | ForEach-Object { $_.Name }\n        }\n        details = $testResults.Details\n        recommendations = @(\n            "Eksik legal dosyalarÄ± oluÅŸturun (privacy-policy.md, terms-of-service.md)",\n            "Robots.txt ve sitemap.xml dosyalarÄ±nÄ± ekleyin",\n            "SEO iÃ§in description.txt ve keywords.txt dosyalarÄ±nÄ± oluÅŸturun",\n            "Web sunucusunda legal sayfalarÄ±nÄ±n eriÅŸilebilir olduÄŸundan emin olun"\n        )\n    }\n\n    $exportData | ConvertTo-Json -Depth 10 | Set-Content $jsonPath\n    Write-ColorOutput "ğŸ“„ Test sonuÃ§larÄ± JSON olarak kaydedildi: $jsonPath" "Green"\n}\n\n# Badge tetikleme\nif ($testResults.PassedTests -gt 0) {\n    Show-Badge "LegalVerified"\n    Show-Badge "SEO-Verified"\n}\n\n# Final sonuÃ§\nWrite-ColorOutput "" "White"\nif ($testResults.FailedTests -eq 0) {\n    Write-ColorOutput "ğŸ‰ TÃ¼m legal ve SEO testleri baÅŸarÄ±lÄ±! CI/CD pipeline devam edebilir." "Green"\n    exit 0\n} else {\n    Write-ColorOutput "ğŸ’¥ BazÄ± legal ve SEO testleri baÅŸarÄ±sÄ±z. LÃ¼tfen eksik dosyalarÄ± oluÅŸturun." "Red"\n    exit 1\n}\n