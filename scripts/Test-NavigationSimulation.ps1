# Test-NavigationSimulation.ps1 - Offline navigation simÃ¼lasyon testi\n# Bu script navigation simÃ¼lasyonunu test eder ve CI/CD pipeline ile entegre Ã§alÄ±ÅŸÄ±r\n\nparam(\n    [string]$TestEnvironment = "local",\n    [string]$Configuration = "Debug",\n    [string]$ProjectPath = $PSScriptRoot,\n    [switch]$SkipBuild,\n    [switch]$Verbose,\n    [switch]$ExportJson,\n    [int]$SimulationSpeed = 500,\n    [string]$SimulationMode = "normal"\n)\n\n# Script ayarlarÄ±\n$ErrorActionPreference = "Stop"\n$VerbosePreference = if ($Verbose) { "Continue" } else { "SilentlyContinue" }\n\n# Test sonuÃ§larÄ± iÃ§in deÄŸiÅŸkenler\n$testResults = @{\n    TotalTests = 0\n    PassedTests = 0\n    FailedTests = 0\n    TestDuration = [TimeSpan]::Zero\n    Details = @()\n}\n\n# Environment deÄŸiÅŸkenlerini ayarla\n$env:TEST_ENVIRONMENT = $TestEnvironment\n$env:CI = if ($TestEnvironment -eq "ci") { "true" } else { "false" }\n$env:SIMULATION_SPEED = $SimulationSpeed.ToString()\n$env:SIMULATION_MODE = $SimulationMode\n$env:ENABLE_SIMULATION_LOGGING = if ($Verbose) { "true" } else { "false" }\n\n# Renkli output iÃ§in\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = "White"\n    )\n    Write-Host $Message -ForegroundColor $Color\n}\n\n# BaÅŸlÄ±k\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "      ğŸš— Navigation SimÃ¼lasyon Testi" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput ""\n\n# Proje yolunu kontrol et\nif (!(Test-Path $ProjectPath)) {\n    Write-ColorOutput "Hata: Proje yolu bulunamadÄ±: $ProjectPath" "Red"\n    exit 1\n}\n\n# Test fonksiyonlarÄ±\nfunction Test-NavigationSimulation {\n    param(\n        [string]$TestName,\n        [scriptblock]$TestScript\n    )\n\n    $startTime = Get-Date\n    $testPassed = $false\n    $errorMessage = ""\n\n    Write-ColorOutput "ğŸ§ª $TestName testi baÅŸlatÄ±lÄ±yor..." "White"\n\n    try {\n        & $TestScript\n        $testPassed = $true\n        Write-ColorOutput "  âœ… $TestName testi baÅŸarÄ±lÄ±" "Green"\n    } catch {\n        $errorMessage = $_.Exception.Message\n        Write-ColorOutput "  âŒ $TestName testi baÅŸarÄ±sÄ±z: $errorMessage" "Red"\n    } finally {\n        $endTime = Get-Date\n        $duration = $endTime - $startTime\n\n        $testResults.TotalTests++\n        if ($testPassed) {\n            $testResults.PassedTests++\n        } else {\n            $testResults.FailedTests++\n        }\n        $testResults.TestDuration += $duration\n\n        $testResults.Details += @{\n            TestName = $TestName\n            Passed = $testPassed\n            Duration = $duration\n            ErrorMessage = $errorMessage\n        }\n    }\n}\n\n# GPS Mock Testi\nfunction Test-GpsMock {\n    Write-ColorOutput "  ğŸ“¡ GPS mock sistemi test ediliyor..." "Gray"\n\n    # GPS konfigÃ¼rasyon dosyasÄ± kontrolÃ¼\n    $gpsConfigPath = Join-Path $env:APPDATA "KesifUygulamasi\SimulationData\gps_config.json"\n    $gpsConfigDir = Split-Path $gpsConfigPath -Parent\n\n    if (!(Test-Path $gpsConfigDir)) {\n        New-Item -ItemType Directory -Path $gpsConfigDir -Force | Out-Null\n    }\n\n    if (Test-Path $gpsConfigPath) {\n        Write-ColorOutput "    âœ… GPS konfigÃ¼rasyon dosyasÄ± bulundu" "Green"\n    } else {\n        Write-ColorOutput "    âš ï¸  GPS konfigÃ¼rasyon dosyasÄ± bulunamadÄ±, oluÅŸturuluyor..." "Yellow"\n        $gpsConfig = @{\n            accuracy = 5.0\n            update_interval = $SimulationSpeed\n            mock_provider = "NavigationSimulator"\n        } | ConvertTo-Json\n        $gpsConfig | Out-File $gpsConfigPath -Encoding UTF8\n    }\n}\n\n# Rota SimÃ¼lasyon Testi\nfunction Test-RouteSimulation {\n    Write-ColorOutput "  ğŸ—ºï¸  Rota simÃ¼lasyonu test ediliyor..." "Gray"\n\n    # Ã–rnek rota oluÅŸtur\n    $sampleRoute = @(\n        @{ Lat = 41.0082; Lng = 28.9784 }, # Ä°stanbul\n        @{ Lat = 41.0151; Lng = 28.9795 }, # ÅiÅŸli\n        @{ Lat = 41.0222; Lng = 28.9855 }, # MecidiyekÃ¶y\n        @{ Lat = 41.0292; Lng = 28.9915 }, # Levent\n        @{ Lat = 41.0362; Lng = 28.9975 }  # 4. Levent\n    )\n\n    Write-ColorOutput "    ğŸ“ Ã–rnek rota oluÅŸturuldu: $($sampleRoute.Count) nokta" "Gray"\n\n    # SimÃ¼lasyon hÄ±zÄ± testi\n    $expectedDuration = ($sampleRoute.Count - 1) * $SimulationSpeed / 1000\n    Write-ColorOutput "    â±ï¸  Beklenen simÃ¼lasyon sÃ¼resi: ${expectedDuration}s" "Gray"\n\n    # SimÃ¼lasyon verisi kontrolÃ¼\n    $simulationDataPath = Join-Path $env:APPDATA "KesifUygulamasi\SimulationData"\n    if (Test-Path $simulationDataPath) {\n        $simulationFiles = Get-ChildItem $simulationDataPath -Filter "simulation_*.json"\n        Write-ColorOutput "    ğŸ“Š Ã–nceki simÃ¼lasyon dosyalarÄ±: $($simulationFiles.Count)" "Gray"\n    }\n}\n\n# Rota SapmasÄ± Testi\nfunction Test-RouteDeviation {\n    Write-ColorOutput "  ğŸš¨ Rota sapmasÄ± simÃ¼lasyonu test ediliyor..." "Gray"\n\n    if ($SimulationMode -eq "deviation_test") {\n        Write-ColorOutput "    ğŸ”„ Sapma dÃ¼zeltme modu aktif" "Gray"\n    } else {\n        Write-ColorOutput "    ğŸ“ Normal rota modu" "Gray"\n    }\n\n    # Sapma algÄ±lama simÃ¼lasyonu\n    $deviationThreshold = 0.001  # ~100 metre\n    Write-ColorOutput "    ğŸ“ Sapma eÅŸiÄŸi: ${deviationThreshold} derece" "Gray"\n}\n\n# Offline Navigation Testi\nfunction Test-OfflineNavigation {\n    Write-ColorOutput "  ğŸ“± Offline navigation testi..." "Gray"\n\n    # Offline veri kontrolÃ¼\n    $offlineDataPath = Join-Path $ProjectPath "OfflineData"\n    if (Test-Path $offlineDataPath) {\n        $tileFiles = Get-ChildItem $offlineDataPath -Filter "*.png" -Recurse\n        Write-ColorOutput "    ğŸ—ºï¸  Offline tile dosyalarÄ±: $($tileFiles.Count)" "Gray"\n    } else {\n        Write-ColorOutput "    âš ï¸  Offline veri klasÃ¶rÃ¼ bulunamadÄ±" "Yellow"\n    }\n}\n\n# Ana test dÃ¶ngÃ¼sÃ¼\nWrite-ColorOutput "ğŸš€ Navigation simÃ¼lasyon testleri baÅŸlatÄ±lÄ±yor..." "White"\nWrite-ColorOutput ""\n\n# Testleri Ã§alÄ±ÅŸtÄ±r\nTest-NavigationSimulation -TestName "GPS Mock Sistemi" -TestScript { Test-GpsMock }\nTest-NavigationSimulation -TestName "Rota SimÃ¼lasyonu" -TestScript { Test-RouteSimulation }\nTest-NavigationSimulation -TestName "Rota SapmasÄ±" -TestScript { Test-RouteDeviation }\nTest-NavigationSimulation -TestName "Offline Navigation" -TestScript { Test-OfflineNavigation }\n\n# Test Ã¶zeti\nWrite-ColorOutput "" "White"\nWrite-ColorOutput "=========================================" "Cyan"\nWrite-ColorOutput "           ğŸ“Š Test SonuÃ§larÄ±" "Cyan"\nWrite-ColorOutput "=========================================" "Cyan"\n\n$successRate = if ($testResults.TotalTests -gt 0) {\n    [math]::Round(($testResults.PassedTests / $testResults.TotalTests) * 100, 1)\n} else { 0 }\n\nWrite-ColorOutput "Toplam Test: $($testResults.TotalTests)" "White"\nWrite-ColorOutput "BaÅŸarÄ±lÄ±: $($testResults.PassedTests)" "Green"\nWrite-ColorOutput "BaÅŸarÄ±sÄ±z: $($testResults.FailedTests)" "Red"\nWrite-ColorOutput "BaÅŸarÄ± OranÄ±: $successRate%" "Cyan"\nWrite-ColorOutput "Toplam SÃ¼re: $($testResults.TestDuration.TotalSeconds) saniye" "White"\n\n# DetaylÄ± sonuÃ§lar\nif ($Verbose) {\n    Write-ColorOutput "" "White"\n    Write-ColorOutput "DetaylÄ± SonuÃ§lar:" "Yellow"\n    foreach ($detail in $testResults.Details) {\n        $status = if ($detail.Passed) { "âœ…" } else { "âŒ" }\n        Write-ColorOutput "  $status $($detail.TestName)" "White"\n        if (!$detail.Passed -and $detail.ErrorMessage) {\n            Write-ColorOutput "    Hata: $($detail.ErrorMessage)" "Red"\n        }\n    }\n}\n\n# JSON export\nif ($ExportJson) {\n    $jsonPath = Join-Path $ProjectPath "navigation-simulation-test-results.json"\n    $exportData = @{\n        metadata = @{\n            timestamp = (Get-Date).ToString("yyyy-MM-ddTHH:mm:ssZ")\n            script_version = "1.0.0"\n            test_environment = $TestEnvironment\n            simulation_speed = $SimulationSpeed\n            simulation_mode = $SimulationMode\n            total_duration_seconds = $testResults.TestDuration.TotalSeconds\n        }\n        summary = @{\n            total_tests = $testResults.TotalTests\n            passed_tests = $testResults.PassedTests\n            failed_tests = $testResults.FailedTests\n            success_rate = $successRate\n            test_duration = $testResults.TestDuration.ToString()\n        }\n        configuration = @{\n            simulation_speed = $SimulationSpeed\n            simulation_mode = $SimulationMode\n            enable_logging = $Verbose\n            test_environment = $TestEnvironment\n        }\n        details = $testResults.Details\n        recommendations = @(\n            "GPS mock sistemini test ortamÄ±nda etkinleÅŸtirin",\n            "Rota sapmasÄ± senaryolarÄ±nÄ± daha sÄ±k test edin",\n            "Offline tile verilerini gÃ¼ncel tutun",\n            "SimÃ¼lasyon hÄ±zÄ±nÄ± CI/CD ortamÄ±na gÃ¶re ayarlayÄ±n"\n        )\n    }\n\n    $exportData | ConvertTo-Json -Depth 10 | Set-Content $jsonPath\n    Write-ColorOutput "ğŸ“„ Test sonuÃ§larÄ± JSON olarak kaydedildi: $jsonPath" "Green"\n}\n\n# Badge tetikleme\nif ($testResults.PassedTests -gt 0) {\n    Show-Badge "Navigation-Simulated"\n}\n\n# Final sonuÃ§\nWrite-ColorOutput "" "White"\nif ($testResults.FailedTests -eq 0) {\n    Write-ColorOutput "ğŸ‰ TÃ¼m navigation simÃ¼lasyon testleri baÅŸarÄ±lÄ±! CI/CD pipeline devam edebilir." "Green"\n    exit 0\n} else {\n    Write-ColorOutput "ğŸ’¥ BazÄ± navigation simÃ¼lasyon testleri baÅŸarÄ±sÄ±z. LÃ¼tfen simÃ¼lasyon ayarlarÄ±nÄ± kontrol edin." "Red"\n    exit 1\n}\n\n# Badge gÃ¶sterme fonksiyonu\nfunction Show-Badge {\n    param([string]$BadgeName)\n\n    Write-ColorOutput "ğŸ… Badge kazanÄ±ldÄ±: $BadgeName" "Cyan"\n\n    # Badge dosyasÄ±nÄ± gÃ¼ncelle (varsa)\n    $badgeFile = Join-Path $ProjectPath "badge.json"\n    if (Test-Path $badgeFile) {\n        try {\n            $badgeData = Get-Content $badgeFile -Raw | ConvertFrom-Json\n            if ($badgeData.PSObject.Properties.Name -notcontains $BadgeName) {\n                $badgeData | Add-Member -MemberType NoteProperty -Name $BadgeName -Value $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            } else {\n                $badgeData.$BadgeName = $true\n                $badgeData | ConvertTo-Json | Set-Content $badgeFile\n                Write-ColorOutput "  âœ… Badge dosyasÄ± gÃ¼ncellendi" "Green"\n            }\n        } catch {\n            Write-ColorOutput "  âš ï¸  Badge dosyasÄ± gÃ¼ncellenemedi" "Yellow"\n        }\n    } else {\n        # Yeni badge dosyasÄ± oluÅŸtur\n        $newBadgeData = @{\n            $BadgeName = $true\n        }\n        $newBadgeData | ConvertTo-Json | Set-Content $badgeFile\n        Write-ColorOutput "  âœ… Yeni badge dosyasÄ± oluÅŸturuldu" "Green"\n    }\n}\n