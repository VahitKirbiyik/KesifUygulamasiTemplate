using System;\n\nnamespace KesifUygulamasiTemplate.Services\n{\n    public enum CalibrationStatus\n    {\n        Unknown,\n        NotCalibrated,\n        LowAccuracy,\n        MediumAccuracy,\n        HighAccuracy\n    }\n\n    public class CompassCalibrationService : ICompassCalibrationService\n    {\n        private CalibrationStatus _status = CalibrationStatus.Unknown;\n        private bool _isCalibrating;\n        private double _calibrationAccuracy;\n        private readonly Random _random = new Random();\n\n        public bool IsCalibrationRequired => _status == CalibrationStatus.NotCalibrated || _status == CalibrationStatus.LowAccuracy;\n        public bool IsCalibrating => _isCalibrating;\n        public double CalibrationAccuracy => _calibrationAccuracy;\n\n        public void StartCalibration()\n        {\n            if (_isCalibrating)\n                return;\n\n            _isCalibrating = true;\n            _status = CalibrationStatus.NotCalibrated;\n            _calibrationAccuracy = 0;\n\n            // Gerçek bir uygulamada burada sensör verileri kullanılır\n            // Bu örnek için rastgele iyileşen bir doğruluk simüle ediyoruz\n            System.Threading.Tasks.Task.Run(async () =>\n            {\n                while (_isCalibrating && _calibrationAccuracy < 0.95)\n                {\n                    await System.Threading.Tasks.Task.Delay(500);\n                    _calibrationAccuracy += _random.NextDouble() * 0.2;\n\n                    if (_calibrationAccuracy > 0.95)\n                    {\n                        _status = CalibrationStatus.HighAccuracy;\n                        _isCalibrating = false;\n                    }\n                    else if (_calibrationAccuracy > 0.6)\n                    {\n                        _status = CalibrationStatus.MediumAccuracy;\n                    }\n                    else if (_calibrationAccuracy > 0.3)\n                    {\n                        _status = CalibrationStatus.LowAccuracy;\n                    }\n                }\n            });\n        }\n\n        public void StopCalibration()\n        {\n            _isCalibrating = false;\n        }\n\n        public void ResetCalibration()\n        {\n            _status = CalibrationStatus.NotCalibrated;\n            _calibrationAccuracy = 0;\n            _isCalibrating = false;\n        }\n    }\n}\n