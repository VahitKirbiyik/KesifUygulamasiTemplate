using System;\nusing System.Threading.Tasks;\nusing Microsoft.Maui.Devices.Sensors;\nusing KesifUygulamasiTemplate.ViewModels.Base;\nusing KesifUygulamasiTemplate.Services.Interfaces;\n\nnamespace KesifUygulamasiTemplate.ViewModels\n{\n    public class NavigationViewModel : BaseViewModel\n    {\n        private readonly ICompassService _compassService;\n        private readonly ILocationService _locationService;\n\n        public Location? CurrentLocation { get; private set; }\n        public Location? TargetLocation { get; set; }\n        public double BearingToTarget { get; private set; } // Hedefe olan yön\n        public double CurrentHeading { get; private set; } // Cihazın mevcut yönü\n\n        public NavigationViewModel(ICompassService compassService, ILocationService locationService)\n        {\n            _compassService = compassService;\n            _locationService = locationService;\n\n            // Compass değişikliklerini dinle\n            _compassService.HeadingChanged += OnCompassHeadingChanged;\n        }\n\n        private void OnCompassHeadingChanged(double heading)\n        {\n            CurrentHeading = heading;\n            OnPropertyChanged(nameof(CurrentHeading));\n        }\n\n        // İki nokta arasındaki yön hesaplama\n        private double CalculateBearing(Location start, Location end)\n        {\n            // Haversine formülü hesaplaması\n            var lat1 = start.Latitude * Math.PI / 180;\n            var lat2 = end.Latitude * Math.PI / 180;\n            var deltaLon = (end.Longitude - start.Longitude) * Math.PI / 180;\n\n            var y = Math.Sin(deltaLon) * Math.Cos(lat2);\n            var x = Math.Cos(lat1) * Math.Sin(lat2) - Math.Sin(lat1) * Math.Cos(lat2) * Math.Cos(deltaLon);\n\n            var bearing = Math.Atan2(y, x) * 180 / Math.PI;\n            return (bearing + 360) % 360;\n        }\n\n        public async Task UpdateCurrentLocationAsync()\n        {\n            CurrentLocation = await _locationService.GetCurrentLocationAsync();\n            OnPropertyChanged(nameof(CurrentLocation));\n        }\n    }\n}\n