name: GeliÅŸmiÅŸ GÃ¼venlik ve Paket Raporlama

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:

jobs:
  security-scan:
    name: GÃ¼venlik TaramasÄ± ve Paket Raporlama
    runs-on: windows-latest

    steps:
      - name: Repo'yu Klonla
        uses: actions/checkout@v4

      - name: .NET Setup
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '8.0.x'

      - name: Paket Listesi ve GÃ¼venlik AÃ§Ä±ÄŸÄ± KontrolÃ¼
        run: |
          echo "=== GÃ¼venlik AÃ§Ä±klarÄ± (Vulnerable) ===" > security_report.txt
          dotnet list package --vulnerable >> security_report.txt || true
          echo "" >> security_report.txt
          echo "=== GÃ¼ncel Olmayan Paketler (Outdated) ===" >> security_report.txt
          dotnet list package --outdated >> security_report.txt || true

      - name: Security Report Artifact Olarak YÃ¼kle
        uses: actions/upload-artifact@v4
        with:
          name: security-report-${{ github.run_number }}
          path: security_report.txt

      - name: GitHub Summary GÃ¼ncelle
        run: |
          echo "## ğŸ”’ GÃ¼venlik ve Paket Raporu" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "<details>" >> $GITHUB_STEP_SUMMARY
          echo "<summary>ğŸ“„ Raporu GÃ¶rÃ¼ntÃ¼le</summary>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ” Vulnerable Paketler" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          dotnet list package --vulnerable || true >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âš ï¸ Outdated Paketler" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          dotnet list package --outdated || true >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Artifact olarak yÃ¼klendi: **security-report-${{ github.run_number }}**" >> $GITHUB_STEP_SUMMARY
          echo "</details>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ’¡ Ä°pucu: Summary'deki 'Raporu GÃ¶rÃ¼ntÃ¼le' yazÄ±sÄ±na tÄ±klayarak detaylarÄ± aÃ§abilir/kapatabilirsiniz." >> $GITHUB_STEP_SUMMARY

      - name: E-posta Bildirimi (Opsiyonel)
        if: false  # E-posta gÃ¶ndermek iÃ§in aktifleÅŸtirin
        run: |
          echo "SMTP ile gÃ¼venlik raporu e-posta gÃ¶nderimi burada yapÄ±labilir."
          # SMTP_USER ve SMTP_PASS secrets'lerini repository ayarlarÄ±ndan tanÄ±mlayÄ±n
          # ArdÄ±ndan if koÅŸulunu dÃ¼zenleyin
