using System;
using System.Collections.Generic;
using KesifUygulamasiTemplate.Utils;
using KesifUygulamasiTemplate.Models;

namespace TestRunner
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("=== PolylineDecoder Testleri Başlatılıyor ===");

            // Test 1: Basit decode testi
            Console.WriteLine("\n1. Basit Decode Testi:");
            string encodedPolyline = "_p~iF~ps|U_ulLnnqC_mqNvxq`@";

            try
            {
                var decodedPoints = PolylineDecoder.Decode(encodedPolyline);
                Console.WriteLine($"Decode edilen nokta sayısı: {decodedPoints.Count}");

                foreach (var point in decodedPoints)
                {
                    Console.WriteLine($"Lat: {point.Lat:F6}, Lng: {point.Lng:F6}");
                }

                // Encode test
                var encodedAgain = PolylineDecoder.Encode(decodedPoints);
                Console.WriteLine($"Tekrar encode edilmiş: {encodedAgain}");
                Console.WriteLine("✓ Basit decode testi başarılı!");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"✗ Test hatası: {ex.Message}");
            }

            // Test 2: Gerçek veri testi
            Console.WriteLine("\n2. Gerçek Veri Testi:");
            var testPoints = new List<LatLng>
            {
                new LatLng(41.0458, 29.0340), // Ortaköy
                new LatLng(41.0465, 29.0352), // Boğaz köprüsü başlangıç
                new LatLng(41.0472, 29.0365), // Boğaz köprüsü orta
                new LatLng(41.0480, 29.0378), // Boğaz köprüsü bitiş
                new LatLng(41.0485, 29.0390)  // Üsküdar
            };

            try
            {
                string encoded = PolylineDecoder.Encode(testPoints);
                Console.WriteLine($"Encode edilmiş polyline: {encoded}");

                var decoded = PolylineDecoder.Decode(encoded);
                Console.WriteLine($"Decode sonrası nokta sayısı: {decoded.Count}");

                // Hassasiyet kontrolü
                bool allWithinTolerance = true;
                for (int i = 0; i < Math.Min(testPoints.Count, decoded.Count); i++)
                {
                    var original = testPoints[i];
                    var decodedPoint = decoded[i];
                    var latDiff = Math.Abs(original.Lat - decodedPoint.Lat);
                    var lngDiff = Math.Abs(original.Lng - decodedPoint.Lng);

                    if (latDiff > 0.00001 || lngDiff > 0.00001)
                        allWithinTolerance = false;

                    Console.WriteLine($"Nokta {i}: Fark - Lat: {latDiff:F8}, Lng: {lngDiff:F8}");
                }

                if (allWithinTolerance)
                    Console.WriteLine("✓ Gerçek veri testi başarılı - Hassasiyet korunmuş!");
                else
                    Console.WriteLine("⚠ Hassasiyet kaybı var ama kabul edilebilir.");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"✗ Gerçek veri testi hatası: {ex.Message}");
            }

            Console.WriteLine("\n=== Testler Tamamlandı ===");
            Console.ReadLine();
        }
    }
}
