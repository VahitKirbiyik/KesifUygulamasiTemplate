using System;\nusing System.ComponentModel;\nusing System.Runtime.CompilerServices;\nusing System.Threading.Tasks;\nusing System.Windows.Input;\nusing KesifUygulamasiTemplate.Services.Interfaces;\nusing KesifUygulamasiTemplate.ViewModels.Base;\nusing Microsoft.Maui.Controls;\n\nnamespace KesifUygulamasiTemplate.ViewModels\n{\n    public class ProfileViewModel : BaseViewModel\n    {\n        private readonly IPreferencesService _preferencesService;\n\n        private string _fullName;\n        private string _email;\n        private string _phone;\n        private bool _isPushNotificationsEnabled;\n        private bool _isEmailNotificationsEnabled;\n        private bool _isSMSNotificationsEnabled;\n        private bool _isLocationTrackingEnabled;\n        private bool _isDataSharingEnabled;\n\n        public string FullName\n        {\n            get => _fullName;\n            set => SetProperty(ref _fullName, value);\n        }\n\n        public string Email\n        {\n            get => _email;\n            set => SetProperty(ref _email, value);\n        }\n\n        public string Phone\n        {\n            get => _phone;\n            set => SetProperty(ref _phone, value);\n        }\n\n        public bool IsPushNotificationsEnabled\n        {\n            get => _isPushNotificationsEnabled;\n            set => SetProperty(ref _isPushNotificationsEnabled, value);\n        }\n\n        public bool IsEmailNotificationsEnabled\n        {\n            get => _isEmailNotificationsEnabled;\n            set => SetProperty(ref _isEmailNotificationsEnabled, value);\n        }\n\n        public bool IsSMSNotificationsEnabled\n        {\n            get => _isSMSNotificationsEnabled;\n            set => SetProperty(ref _isSMSNotificationsEnabled, value);\n        }\n\n        public bool IsLocationTrackingEnabled\n        {\n            get => _isLocationTrackingEnabled;\n            set => SetProperty(ref _isLocationTrackingEnabled, value);\n        }\n\n        public bool IsDataSharingEnabled\n        {\n            get => _isDataSharingEnabled;\n            set => SetProperty(ref _isDataSharingEnabled, value);\n        }\n\n        public ICommand SaveProfileCommand { get; }\n        public ICommand CancelCommand { get; }\n\n        public ProfileViewModel(KesifUygulamasiTemplate.Services.Interfaces.IPreferencesService preferencesService)\n        {\n            _preferencesService = preferencesService;\n\n            SaveProfileCommand = new Command(async () => await SaveProfileAsync());\n            CancelCommand = new Command(async () => await CancelAsync());\n\n            LoadProfileData();\n        }\n\n        private void LoadProfileData()\n        {\n            try\n            {\n                // Local preferences'den verileri yükle\n                FullName = _preferencesService.Get("UserFullName", string.Empty);\n                Email = _preferencesService.Get("UserEmail", string.Empty);\n                Phone = _preferencesService.Get("UserPhone", string.Empty);\n\n                IsPushNotificationsEnabled = _preferencesService.Get("PushNotificationsEnabled", true);\n                IsEmailNotificationsEnabled = _preferencesService.Get("EmailNotificationsEnabled", true);\n                IsSMSNotificationsEnabled = _preferencesService.Get("SMSNotificationsEnabled", false);\n                IsLocationTrackingEnabled = _preferencesService.Get("LocationTrackingEnabled", true);\n                IsDataSharingEnabled = _preferencesService.Get("DataSharingEnabled", false);\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.WriteLine($"Failed to load profile data: {ex.Message}");\n            }\n        }\n\n        private async Task SaveProfileAsync()\n        {\n            try\n            {\n                // Verileri local preferences'e kaydet\n                _preferencesService.Set("UserFullName", FullName ?? string.Empty);\n                _preferencesService.Set("UserEmail", Email ?? string.Empty);\n                _preferencesService.Set("UserPhone", Phone ?? string.Empty);\n\n                _preferencesService.Set("PushNotificationsEnabled", IsPushNotificationsEnabled);\n                _preferencesService.Set("EmailNotificationsEnabled", IsEmailNotificationsEnabled);\n                _preferencesService.Set("SMSNotificationsEnabled", IsSMSNotificationsEnabled);\n                _preferencesService.Set("LocationTrackingEnabled", IsLocationTrackingEnabled);\n                _preferencesService.Set("DataSharingEnabled", IsDataSharingEnabled);\n\n                // Başarı mesajı göster\n                if (Application.Current?.MainPage != null)\n                {\n                    await Application.Current.MainPage.DisplayAlert(\n                        "Başarılı",\n                        "Profil bilgileriniz kaydedildi.",\n                        "Tamam");\n                }\n\n                // Ana sayfaya dön\n                await Shell.Current.GoToAsync("//MainPage");\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.WriteLine($"Failed to save profile: {ex.Message}");\n\n                if (Application.Current?.MainPage != null)\n                {\n                    await Application.Current.MainPage.DisplayAlert(\n                        "Hata",\n                        "Profil kaydedilirken bir hata oluştu.",\n                        "Tamam");\n                }\n            }\n        }\n\n        private async Task CancelAsync()\n        {\n            // Değişiklikleri iptal et ve ana sayfaya dön\n            await Shell.Current.GoToAsync("//MainPage");\n        }\n    }\n}\n