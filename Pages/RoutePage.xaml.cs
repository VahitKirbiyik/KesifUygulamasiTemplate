using Microsoft.Maui.Controls;\nusing Microsoft.Maui.Controls.Maps;\nusing Microsoft.Maui.Devices.Sensors;\nusing Microsoft.Maui.Maps;\nusing KesifUygulamasiTemplate.ViewModels;\nusing KesifUygulamasiTemplate.Services.Interfaces;\n\nnamespace KesifUygulamasiTemplate.Pages\n{\n    public partial class RoutePage : ContentPage\n    {\n        private readonly RouteViewModel _viewModel;\n        private Polyline _routeLine;\n\n        public RoutePage(IRouteService routeService, ITrafficService trafficService)\n        {\n            InitializeComponent();\n            _viewModel = new RouteViewModel(routeService, trafficService);\n            BindingContext = _viewModel;\n            _viewModel.PropertyChanged += ViewModel_PropertyChanged;\n        }\n\n        protected override void OnAppearing()\n        {\n            base.OnAppearing();\n            // Varsay�lan ba�lang��/var�� de�erleri\n            StartEntry.Text = "39.9,32.8";\n        }\n\n        protected override void OnDisappearing()\n        {\n            base.OnDisappearing();\n            // Temizleme i�lemleri\n            _viewModel.PropertyChanged -= ViewModel_PropertyChanged;\n        }\n\n        private void ViewModel_PropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)\n        {\n            if (e.PropertyName == nameof(_viewModel.RoutePoints))\n            {\n                DrawRoute();\n            }\n        }\n\n        private void DrawRoute()\n        {\n            if (_routeLine != null)\n                RouteMap.MapElements.Remove(_routeLine);\n\n            if (_viewModel.RoutePoints.Count < 2)\n                return;\n\n            _routeLine = new Polyline\n            {\n                StrokeColor = Colors.Blue,\n                StrokeWidth = 4\n            };\n\n            foreach (var loc in _viewModel.RoutePoints)\n                _routeLine.Geopath.Add(new Location(loc.Latitude, loc.Longitude));\n\n            RouteMap.MapElements.Add(_routeLine);\n\n            // Haritay� rotan�n ortas�na odakla\n            var center = _viewModel.RoutePoints[_viewModel.RoutePoints.Count / 2];\n            RouteMap.MoveToRegion(MapSpan.FromCenterAndRadius(\n                new Location(center.Latitude, center.Longitude),\n                Distance.FromKilometers(20)));\n        }\n    }\n}\n