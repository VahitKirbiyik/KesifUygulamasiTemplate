using System;\nusing System.Collections.ObjectModel;\nusing System.Linq;\nusing Microsoft.Maui.Controls;\nusing KesifUygulamasiTemplate.Models;\nusing KesifUygulamasiTemplate.Services;\n\nnamespace KesifUygulamasiTemplate.Pages\n{\n    public partial class LocationsPage : ContentPage\n    {\n        readonly Services.DatabaseService _databaseService;\n        ObservableCollection<LocationModel> _locations = new();\n\n        public LocationsPage(DatabaseService databaseService)\n        {\n            InitializeComponent();\n            _databaseService = databaseService ?? throw new ArgumentNullException(nameof(databaseService));\n        }\n\n        protected override async void OnAppearing()\n        {\n            base.OnAppearing();\n\n            try\n            {\n                var locationList = await _databaseService.GetAllAsync();\n                _locations = new ObservableCollection<LocationModel>(locationList);\n                LocationsCollectionView.ItemsSource = _locations;\n            }\n            catch (Exception ex)\n            {\n                await DisplayAlert("Hata", $"Konumlar yüklenemedi: {ex.Message}", "Tamam");\n            }\n        }\n\n        private async void OnLocationSelected(object sender, SelectionChangedEventArgs e)\n        {\n            if (e.CurrentSelection.FirstOrDefault() is LocationModel selectedLocation)\n            {\n                bool silinsinMi = await DisplayAlert("Sil?", $"{selectedLocation.Title} konumu silinsin mi?", "Evet", "Hayır");\n                if (silinsinMi)\n                {\n                    try\n                    {\n                        await _databaseService.DeleteLocationAsync(selectedLocation);\n                        _locations.Remove(selectedLocation);\n                    }\n                    catch (Exception ex)\n                    {\n                        await DisplayAlert("Hata", $"Silinemedi: {ex.Message}", "Tamam");\n                    }\n                }\n\n                LocationsCollectionView.SelectedItem = null;\n            }\n        }\n\n        private async void OnAddLocationClicked(object sender, EventArgs e)\n        {\n            await Shell.Current.GoToAsync("//Map");\n        }\n    }\n}\n