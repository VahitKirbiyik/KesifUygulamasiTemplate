# ğŸ“¦ KesifApp Android App Bundle OluÅŸturma Scripti\n\nparam(\n    [string]$Configuration = "Release",\n    [string]$OutputPath = ".\publish",\n    [string]$KeystorePath = ".\keystore\kesifapp.keystore",\n    [SecureString]$KeystorePassword,\n    [string]$KeyAlias = "kesifapp_key",\n    [switch]$Clean,\n    [switch]$NoSign,\n    [switch]$Help\n)\n\n# Script bilgileri\n$ScriptVersion = "1.0.0"\n$LastUpdated = "30 AÄŸustos 2025"\n\n# Renk tanÄ±mlarÄ±\n$Green = "Green"\n$Yellow = "Yellow"\n$Red = "Red"\n$Cyan = "Cyan"\n$White = "White"\n\nfunction Write-ColorOutput {\n    param(\n        [string]$Message,\n        [string]$Color = $White\n    )\n    Write-Host $Message -ForegroundColor $Color\n}\n\nfunction Show-Help {\n    Write-ColorOutput "`nğŸ“¦ KesifApp Android App Bundle Builder v$ScriptVersion" $Cyan\n    Write-ColorOutput "Son gÃ¼ncelleme: $LastUpdated`n" $Yellow\n\n    Write-ColorOutput "KULLANIM:" $Green\n    Write-ColorOutput "  .\build-aab.ps1 [parametreler]`n"\n\n    Write-ColorOutput "PARAMETRELER:" $Green\n    Write-ColorOutput "  -Configuration <config>    Build konfigÃ¼rasyonu (varsayÄ±lan: Release)"\n    Write-ColorOutput "  -OutputPath <path>         Ã‡Ä±ktÄ± klasÃ¶rÃ¼ (varsayÄ±lan: .\publish)"\n    Write-ColorOutput "  -KeystorePath <path>       Keystore dosya yolu"\n    Write-ColorOutput "  -KeystorePassword <pass>   Keystore ÅŸifresi (varsayÄ±lan: Ã§evre deÄŸiÅŸkeninden)"\n    Write-ColorOutput "  -KeyAlias <alias>          Anahtar takma adÄ± (varsayÄ±lan: kesifapp_key)"\n    Write-ColorOutput "  -Clean                     Temiz build yapar"\n    Write-ColorOutput "  -NoSign                    Ä°mzalama yapmadan build eder"\n    Write-ColorOutput "  -Help                      Bu yardÄ±m mesajÄ±nÄ± gÃ¶sterir`n"\n\n    Write-ColorOutput "Ã–RNEKLER:" $Green\n    Write-ColorOutput "  .\build-aab.ps1"\n    Write-ColorOutput "  .\build-aab.ps1 -Configuration Debug -NoSign"\n    Write-ColorOutput "  .\build-aab.ps1 -Clean -OutputPath .\output`n"\n\n    Write-ColorOutput "GEREKSÄ°NÄ°MLER:" $Yellow\n    Write-ColorOutput "  - .NET 8.0 SDK"\n    Write-ColorOutput "  - Android SDK (API 34)"\n    Write-ColorOutput "  - Java JDK 17+"\n    Write-ColorOutput "  - Android keystore (imzalama iÃ§in)`n"\n}\n\nfunction Test-Prerequisites {\n    Write-ColorOutput "`nğŸ” Gereksinim kontrolÃ¼ yapÄ±lÄ±yor..." $Cyan\n\n    # .NET SDK kontrolÃ¼\n    try {\n        $dotnetVersion = dotnet --version\n        Write-ColorOutput "âœ… .NET SDK: $dotnetVersion" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ .NET SDK bulunamadÄ±. LÃ¼tfen .NET 8.0 SDK yÃ¼kleyin." $Red\n        return $false\n    }\n\n    # Android SDK kontrolÃ¼\n    $androidHome = $env:ANDROID_HOME\n    if ($androidHome -and (Test-Path $androidHome)) {\n        Write-ColorOutput "âœ… Android SDK: $androidHome" $Green\n    }\n    else {\n        Write-ColorOutput "âŒ Android SDK bulunamadÄ±. ANDROID_HOME Ã§evre deÄŸiÅŸkenini ayarlayÄ±n." $Red\n        return $false\n    }\n\n    # Java kontrolÃ¼\n    try {\n        $javaVersion = java -version 2>&1 | Select-String "version"\n        Write-ColorOutput "âœ… Java: $javaVersion" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Java JDK bulunamadÄ±. LÃ¼tfen JDK 17+ yÃ¼kleyin." $Red\n        return $false\n    }\n\n    # Keystore kontrolÃ¼\n    if (-not $NoSign) {\n        if (Test-Path $KeystorePath) {\n            Write-ColorOutput "âœ… Keystore: $KeystorePath" $Green\n        }\n        else {\n            Write-ColorOutput "âŒ Keystore bulunamadÄ±: $KeystorePath" $Red\n            return $false\n        }\n    }\n\n    Write-ColorOutput "ğŸ‰ TÃ¼m gereksinimler saÄŸlandÄ±!`n" $Green\n    return $true\n}\n\nfunction CleanProject {\n    Write-ColorOutput "`nğŸ§¹ Proje temizleniyor..." $Cyan\n\n    try {\n        dotnet clean\n        Write-ColorOutput "âœ… Clean tamamlandÄ±" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Clean baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n        return $false\n    }\n\n    return $true\n}\n\nfunction Restore-Packages {\n    Write-ColorOutput "`nğŸ“¦ NuGet paketleri geri yÃ¼kleniyor..." $Cyan\n\n    try {\n        dotnet restore\n        Write-ColorOutput "âœ… Paket geri yÃ¼kleme tamamlandÄ±" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Paket geri yÃ¼kleme baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n        return $false\n    }\n\n    return $true\n}\n\nfunction Build-Project {\n    Write-ColorOutput "`nğŸ”¨ Proje derleniyor..." $Cyan\n    Write-ColorOutput "KonfigÃ¼rasyon: $Configuration" $Yellow\n\n    try {\n        dotnet build -c $Configuration --no-restore\n        Write-ColorOutput "âœ… Build tamamlandÄ±" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Build baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n        return $false\n    }\n\n    return $true\n}\n\nfunction Publish-Android {\n    Write-ColorOutput "`nğŸ“± Android App Bundle yayÄ±nlanÄ±yor..." $Cyan\n\n    $publishArgs = @(\n        "publish",\n        "-c", $Configuration,\n        "-f", "net8.0-android",\n        "--android-platform", "34",\n        "--self-contained",\n        "-p:AndroidPackageFormat=aab",\n        "-p:ApplicationId=com.vahit.kesifuygulamasi",\n        "-p:ApplicationVersion=4",\n        "-p:ApplicationDisplayVersion=1.0.0",\n        "-o", $OutputPath\n    )\n\n    try {\n        & dotnet $publishArgs\n        Write-ColorOutput "âœ… Android publish tamamlandÄ±" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Android publish baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n        return $false\n    }\n\n    return $true\n}\n\nfunction SignBundle {\n    if ($NoSign) {\n        Write-ColorOutput "`nâ­ï¸  Ä°mzalama atlanÄ±yor (-NoSign parametresi)" $Yellow\n        return $true\n    }\n\n    Write-ColorOutput "`nğŸ” App Bundle imzalanÄ±yor..." $Cyan\n\n    # Keystore ÅŸifresini al\n    if (-not $KeystorePassword) {\n        $KeystorePassword = Read-Host "Keystore ÅŸifresini girin" -AsSecureString\n        if (-not $KeystorePassword) {\n            Write-ColorOutput "âŒ Keystore ÅŸifresi gerekli" $Red\n            return $false\n        }\n    }\n\n    $bundlePath = Join-Path $OutputPath "com.vahit.kesifuygulamasi-Signed.aab"\n    $unsignedBundlePath = Get-ChildItem $OutputPath -Filter "*.aab" | Select-Object -First 1\n\n    if (-not $unsignedBundlePath) {\n        Write-ColorOutput "âŒ AAB dosyasÄ± bulunamadÄ±" $Red\n        return $false\n    }\n\n    try {\n        # jarsigner ile imzalama\n        & jarsigner -verbose -sigalg SHA256withRSA -digestalg SHA-256 -keystore $KeystorePath -storepass $KeystorePassword -keypass $KeystorePassword $unsignedBundlePath.FullName $KeyAlias\n\n        # Ä°mzalÄ± dosyayÄ± yeniden adlandÄ±r\n        Move-Item $unsignedBundlePath.FullName $bundlePath -Force\n\n        Write-ColorOutput "âœ… Ä°mzalama tamamlandÄ±: $bundlePath" $Green\n    }\n    catch {\n        Write-ColorOutput "âŒ Ä°mzalama baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n        return $false\n    }\n\n    return $true\n}\n\nfunction VerifyBundle {\n    Write-ColorOutput "`nğŸ” App Bundle doÄŸrulanÄ±yor..." $Cyan\n\n    $bundlePath = Get-ChildItem $OutputPath -Filter "*.aab" | Select-Object -First 1\n\n    if (-not $bundlePath) {\n        Write-ColorOutput "âŒ AAB dosyasÄ± bulunamadÄ±" $Red\n        return $false\n    }\n\n    # Dosya boyutu kontrolÃ¼\n    $fileSize = (Get-Item $bundlePath.FullName).Length / 1MB\n    Write-ColorOutput "ğŸ“Š Dosya boyutu: $([math]::Round($fileSize, 2)) MB" $Yellow\n\n    if ($fileSize -gt 150) {\n        Write-ColorOutput "âš ï¸  Dosya boyutu bÃ¼yÃ¼k (>150MB). Play Store limiti kontrol edin." $Yellow\n    }\n\n    # Ä°mza kontrolÃ¼\n    if (-not $NoSign) {\n        try {\n            $verifyResult = & jarsigner -verify -verbose $bundlePath.FullName 2>&1\n            if ($verifyResult -match "verified") {\n                Write-ColorOutput "âœ… Ä°mza doÄŸrulandÄ±" $Green\n            }\n            else {\n                Write-ColorOutput "âŒ Ä°mza doÄŸrulanamadÄ±" $Red\n                return $false\n            }\n        }\n        catch {\n            Write-ColorOutput "âŒ Ä°mza kontrolÃ¼ baÅŸarÄ±sÄ±z: $($_.Exception.Message)" $Red\n            return $false\n        }\n    }\n\n    Write-ColorOutput "âœ… Bundle doÄŸrulama tamamlandÄ±" $Green\n    return $true\n}\n\nfunction Show-Summary {\n    Write-ColorOutput "`nğŸŠ BUILD Ã–ZETÄ°" $Cyan\n    Write-ColorOutput "=" * 50 $Cyan\n\n    $bundlePath = Get-ChildItem $OutputPath -Filter "*.aab" | Select-Object -First 1\n\n    if ($bundlePath) {\n        Write-ColorOutput "ğŸ“¦ App Bundle: $($bundlePath.FullName)" $Green\n        Write-ColorOutput "ğŸ“Š Boyut: $([math]::Round((Get-Item $bundlePath.FullName).Length / 1MB, 2)) MB" $Green\n        Write-ColorOutput "ğŸ“… OluÅŸturulma: $(Get-Item $bundlePath.FullName).CreationTime" $Green\n    }\n\n    Write-ColorOutput "`nğŸš€ SONRAKÄ° ADIMLAR:" $Yellow\n    Write-ColorOutput "1. Google Play Console'a giriÅŸ yapÄ±n" $White\n    Write-ColorOutput "2. KesifApp uygulamasÄ±nÄ± seÃ§in" $White\n    Write-ColorOutput "3. 'Ãœretim' sekmesine gidin" $White\n    Write-ColorOutput "4. App Bundle dosyasÄ±nÄ± yÃ¼kleyin" $White\n    Write-ColorOutput "5. YayÄ±nlamayÄ± baÅŸlatÄ±n" $White\n\n    Write-ColorOutput "`nğŸ“ DESTEK:" $Yellow\n    Write-ColorOutput "GitHub: https://github.com/VahitKirbiyik/KesifUygulamasiTemplate" $White\n    Write-ColorOutput "Issues: https://github.com/VahitKirbiyik/KesifUygulamasiTemplate/issues" $White\n}\n\n# Ana script mantÄ±ÄŸÄ±\nfunction Main {\n    if ($Help) {\n        Show-Help\n        return\n    }\n\n    Write-ColorOutput "`nğŸš€ KesifApp Android App Bundle Builder baÅŸlatÄ±lÄ±yor..." $Cyan\n    Write-ColorOutput "Versiyon: $ScriptVersion | Tarih: $LastUpdated" $Yellow\n\n    # Gereksinim kontrolÃ¼\n    if (-not (Test-Prerequisites)) {\n        Write-ColorOutput "`nâŒ Gereksinimler saÄŸlanamadÄ±. Script durduruluyor." $Red\n        exit 1\n    }\n\n    # Ã‡Ä±ktÄ± klasÃ¶rÃ¼ oluÅŸtur\n    if (-not (Test-Path $OutputPath)) {\n        New-Item -ItemType Directory -Path $OutputPath | Out-Null\n        Write-ColorOutput "ğŸ“ Ã‡Ä±ktÄ± klasÃ¶rÃ¼ oluÅŸturuldu: $OutputPath" $Green\n    }\n\n    # Temizleme\n    if ($Clean) {\n        if (-not (CleanProject)) {\n            exit 1\n        }\n    }\n\n    # Paket geri yÃ¼kleme\n    if (-not (Restore-Packages)) {\n        exit 1\n    }\n\n    # Build\n    if (-not (Build-Project)) {\n        exit 1\n    }\n\n    # Android publish\n    if (-not (Publish-Android)) {\n        exit 1\n    }\n\n    # Ä°mzalama\n    if (-not (SignBundle)) {\n        exit 1\n    }\n\n    # DoÄŸrulama\n    if (-not (VerifyBundle)) {\n        exit 1\n    }\n\n    # Ã–zet\n    Show-Summary\n\n    Write-ColorOutput "`nğŸ‰ KesifApp App Bundle baÅŸarÄ±yla oluÅŸturuldu!" $Green\n    Write-ColorOutput "ArtÄ±k Play Store'a yÃ¼klemeye hazÄ±rsÄ±nÄ±z! ğŸš€`n" $Green\n}\n\n# Script'i Ã§alÄ±ÅŸtÄ±r\nMain\n